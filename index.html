<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>eMigrant ‚Äî Miniapp MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Telegram Web Apps SDK (–±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å; –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--bg:#0f1115;--card:#171a21;--text:#e7eaf0;--muted:#9aa3b2;--accent:#7cdfff;--line:#242936;--ok:#33d69e;--warn:#ffb84d;}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:920px;margin:0 auto;padding:16px 16px 86px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-bottom:12px}
    h1,h2,h3{margin:0 0 10px} .small{color:var(--muted);font-size:13px}
    input,select,button,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--line);background:#0c0f14;color:var(--text);margin-top:6px}
    button{cursor:pointer} button.primary{background:#2a73ff;border-color:#2a73ff}
    .row{display:flex;gap:8px;align-items:center} .row> *{flex:1}
    .progress{height:10px;background:#0c0f14;border:1px solid var(--line);border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:#2a73ff}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--line);color:var(--muted)}
    .ok{color:var(--ok);border-color:var(--ok)} .warn{color:var(--warn);border-color:var(--warn)}
    .bottom{position:fixed;left:0;right:0;bottom:0;background:#0c0f14;border-top:1px solid var(--line);display:flex;gap:6px;padding:8px}
    .bottom button{flex:1}
    header{position:sticky;top:0;background:linear-gradient(180deg,#0f1115,rgba(15,17,21,0.6));backdrop-filter:blur(6px);z-index:2;border-bottom:1px solid var(--line);padding:12px}
    .hint{margin:8px 0 0}
  </style>
</head>
<body>
<div class="wrap">
  <header><h2 id="title">eMigrant ¬∑ –û–Ω–±–æ—Ä–¥–∏–Ω–≥</h2></header>

  <!-- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (8 –≤–æ–ø—Ä–æ—Å–æ–≤) -->
  <div id="onb" class="card">
    <div class="badge">–®–∞–≥ <span id="step">1</span>/8</div>

    <!-- Q1: –ò–º—è/–§–∞–º–∏–ª–∏—è -->
    <div id="q1">
      <h3>1) –ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?</h3>
      <label>–ò–º—è</label>
      <input id="firstName" placeholder="–ò–º—è"/>
      <label>–§–∞–º–∏–ª–∏—è</label>
      <input id="lastName" placeholder="–§–∞–º–∏–ª–∏—è"/>
      <div class="row" style="margin-top:10px">
        <span></span>
        <button class="primary" onclick="nextQValidated(1,2)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q2: –í–æ–µ–≤–æ–¥—Å—Ç–≤–æ -->
    <div id="q2" style="display:none">
      <h3>2) –ì–¥–µ —Ç—ã –∂–∏–≤—ë—à—å?</h3>
      <select id="voivodeship">
        <option value="Mazowieckie">Mazowieckie</option>
        <option value="Ma≈Çopolskie">Ma≈Çopolskie</option>
        <option value="Pomorskie">Pomorskie</option>
        <option value="Dolno≈õlƒÖskie">Dolno≈õlƒÖskie</option>
        <option value="Inne">Inne</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(1)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(2,3)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q3: –ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ -->
    <div id="q3" style="display:none">
      <h3>3) –ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ</h3>
      <select id="citizenship">
        <option value="UKR">–£–∫—Ä</option>
        <option value="BLR">–ë–µ–ª</option>
        <option value="RUS">–†—É—Å</option>
        <option value="Other">–î—Ä—É–≥–æ–µ</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(2)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(3,4)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q4: –°—Ä–æ–∫ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è -->
    <div id="q4" style="display:none">
      <h3>4) –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—ã –≤ –ü–æ–ª—å—à–µ?</h3>
      <select id="stayLength">
        <option value="2-3">2‚Äì3 –≥–æ–¥–∞</option>
        <option value="<=1">–≥–æ–¥ –∏ –º–µ–Ω—å—à–µ</option>
        <option value=">=4">–±–æ–ª—å—à–µ 4 –ª–µ—Ç</option>
        <option value="new">—Ç–æ–ª—å–∫–æ –ø—Ä–∏–µ—Ö–∞–ª</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(3)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(4,5)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q5: –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å -->
    <div id="q5" style="display:none">
      <h3>5) –¢–≤–æ–π —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h3>
      <select id="currentStatus">
        <option value="waiting">–ñ–¥—É</option>
        <option value="refused">–ü–æ–ª—É—á–∏–ª –æ—Ç–∫–∞–∑</option>
        <option value="statusUKR">Status UKR</option>
        <option value="pobytCzasowy">Pobyt Czasowy</option>
        <option value="other">Inne (Karta Polaka, Karta Rezydenta UE)</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(4)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(5,6)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q6: –û—Å–Ω–æ–≤–∞–Ω–∏—è (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä) -->
    <div id="q6" style="display:none">
      <h3>6) –ö–∞–∫–∏–µ —É —Ç–µ–±—è –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Å–Ω–æ–≤–∞–Ω–∏—è –¥–ª—è –í–ù–ñ?</h3>
      <div class="small">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ.</div>
      <label><input type="checkbox" class="grounds" value="UoP"> –†–∞–±–æ—Ç–∞ (UoP)</label>
      <label><input type="checkbox" class="grounds" value="UoD"> –†–∞–±–æ—Ç–∞ (UoD)</label>
      <label><input type="checkbox" class="grounds" value="UoZ"> –†–∞–±–æ—Ç–∞ (UoZ)</label>
      <label><input type="checkbox" class="grounds" value="Dzialalnosc"> –†–∞–±–æ—Ç–∞ (Dzia≈Çalno≈õƒá)</label>
      <label><input type="checkbox" class="grounds" value="Study"> –£—á—ë–±–∞</label>
      <label><input type="checkbox" class="grounds" value="Family"> –°–µ–º—å—è</label>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(5)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(6,7)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q7: –î–æ—Ö–æ–¥ -->
    <div id="q7" style="display:none">
      <h3>7) –¢–≤–æ–π –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ (brutto)</h3>
      <select id="income">
        <option value="<4700">–¥–æ 4700</option>
        <option value="4800-10000">4800‚Äì10000</option>
        <option value=">10000">10000+</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(6)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(7,8)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q8: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ü–µ–ª—å -->
    <div id="q8" style="display:none">
      <h3>8) –¢–≤–æ—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ü–µ–ª—å –≤ –ü–æ–ª—å—à–µ</h3>
      <select id="goal">
        <option value="wait">–ü–µ—Ä–µ–∂–¥–∞—Ç—å –±—É—Ä—é</option>
        <option value="euResidentMaybe">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞, –Ω–æ –Ω–∞—Å—á—ë—Ç –ø–∞—Å–ø–æ—Ä—Ç–∞ –Ω–µ—É–≤–µ—Ä–µ–Ω</option>
        <option value="passport">–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button onclick="prevQ(7)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="finishOnb()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div class="small" style="margin-top:8px">–ö–Ω–æ–ø–∫–∞ ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–π–¥—ë—Ç –∫ —á–µ–∫–ª–∏—Å—Ç—É (PDF –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ).</div>
    </div>
  </div>

  <!-- –ß–µ–∫–ª–∏—Å—Ç -->
  <div id="home" style="display:none">
    <div class="card">
      <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
      <div class="progress"><span id="progressBar" style="width:0%"></span></div>
      <div class="small" style="margin-top:6px">–ì–æ—Ç–æ–≤–æ: <span id="doneCount">0</span>/<span id="totalCount">0</span></div>
      <div id="officeHint" class="small hint"></div>
    </div>

    <div id="tasks"></div>

    <!-- üîÑ –í–†–ï–ú–ï–ù–ù–ê–Ø –ö–ù–û–ü–ö–ê –°–ë–†–û–°–ê –î–õ–Ø –¢–ï–°–¢–û–í -->
    <div style="margin-top:16px; text-align:center">
      <button onclick="resetOnb()">üîÑ Reset (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)</button>
    </div>
  </div>
</div>

<!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<div class="bottom">
  <button onclick="openChecklist()">Checklist</button>
  <button onclick="openModule('aiTranslator')">AI Translator</button>
  <button onclick="openModule('findSlot')">Book a slot</button>
  <button onclick="openModule('bookAssistant')">Start a chat</button>
</div>

<script>
  // ===== –ò–ù–ò–¶ Telegram WebApp (–º—è–≥–∫–æ, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  try { tg && tg.ready(); tg && tg.expand(); } catch(e) {}

  // ===== –ü–†–û–°–¢–ï–ô–®–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï (localStorage)
  const st = {
    track: localStorage.getItem('track') || null,
    tasks: JSON.parse(localStorage.getItem('tasks')||'[]'),
    profile: JSON.parse(localStorage.getItem('profile')||'{}')
  };

  // –ë–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ —Ç—Ä–µ–∫—É (—É–ø—Ä–æ—â—ë–Ω–Ω–æ –ø–æ–¥ —Ç–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞)
  function baseTasks(track){
    const common = [
      {id:'wniosek', title:'Wniosek (PDF)', status:'todo', requiresAI:true, kind:'wniosek'},
      {id:'photos', title:'–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', status:'todo', requiresAI:false, kind:'photos'},
      {id:'skarb', title:'Op≈Çata skarbowa', status:'todo', requiresAI:false, kind:'skarb'},
      {id:'rent', title:'Umowa najmu / Meldunek', status:'todo', requiresAI:true, kind:'rent'},
      {id:'ins', title:'Ubezpieczenie', status:'todo', requiresAI:true, kind:'insurance'},
      {id:'slot', title:'Find a slot', status:'todo', requiresAI:false, kind:'slot'},
      {id:'ai', title:'AI Translator', status:'todo', requiresAI:false, kind:'aiTranslator'},
      {id:'assist', title:'Book an assistant', status:'todo', requiresAI:false, kind:'bookAssistant'}
    ];
    if(track==='work'||track==='business'){
      common.splice(2,0,{id:'contract', title:'–ö–æ–Ω—Ç—Ä–∞–∫—Ç / –û—Å–Ω–æ–≤–∞–Ω–∏–µ', status:'todo', requiresAI:true, kind:'contract'});
      common.splice(3,0,{id:'hr', title:'Za≈ÇƒÖcznik od pracodawcy', status:'todo', requiresAI:true, kind:'attachmentHR'});
    }
    if(track==='study'){
      common.splice(2,0,{id:'uni', title:'–°–ø—Ä–∞–≤–∫–∞ –∏–∑ –≤—É–∑–∞', status:'todo', requiresAI:true, kind:'university'});
      common.splice(3,0,{id:'funds', title:'–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö', status:'todo', requiresAI:true, kind:'funds'});
    }
    return common;
  }

  // –ú–∞–ø–ø–∏–Ω–≥ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞ ‚Üí –ø–æ–¥—Å–∫–∞–∑–∫–∞/—Å—Å—ã–ª–∫–∞ (–∑–∞–≥–ª—É—à–∫–∏)
  function officeHintByVoiv(v){
    const map = {
      'Mazowieckie': '–í–∞—à —É–∂–æ–Ω–¥: Mazowiecki. –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ñ–æ—Ä–º—É–ª—è—Ä–∞–º: https://mazowieckie.example',
      'Ma≈Çopolskie': '–í–∞—à —É–∂–æ–Ω–¥: Ma≈Çopolski. –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ñ–æ—Ä–º—É–ª—è—Ä–∞–º: https://malopolskie.example',
      'Pomorskie': '–í–∞—à —É–∂–æ–Ω–¥: Pomorski. –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ñ–æ—Ä–º—É–ª—è—Ä–∞–º: https://pomorskie.example',
      'Dolno≈õlƒÖskie': '–í–∞—à —É–∂–æ–Ω–¥: Dolno≈õlƒÖski. –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ñ–æ—Ä–º—É–ª—è—Ä–∞–º: https://dolnoslaskie.example',
      'Inne': '–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —É–∂–æ–Ω–¥–∞–º –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞: https://gov.example'
    };
    return map[v] || '';
  }

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–µ–∫ –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—è–º (Q6)
  function determineTrack(groundValues){
    const has = k => groundValues.includes(k);
    if (has('Study')) return 'study';
    if (has('Family')) return 'family';
    if (has('Dzialalnosc')) return 'business';
    if (has('UoP') || has('UoD') || has('UoZ')) return 'work';
    // –¥–µ—Ñ–æ–ª—Ç ‚Äî —Ä–∞–±–æ—Ç–∞ (—á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—É—Å—Ç—ã–º)
    return 'work';
  }

  // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –∑–∞–¥–∞—á
  function renderChecklist(){
    const title = st.profile?.trackLabel ? `eMigrant ¬∑ –ß–µ–∫–ª–∏—Å—Ç (${st.profile.trackLabel})` : 'eMigrant ¬∑ –ß–µ–∫–ª–∏—Å—Ç';
    document.getElementById('title').innerText = title;

    const tasksDiv = document.getElementById('tasks');
    tasksDiv.innerHTML = '';
    const done = st.tasks.filter(t=>t.status==='done').length;
    const total = st.tasks.length || 1;
    document.getElementById('doneCount').innerText = done;
    document.getElementById('totalCount').innerText = total;
    document.getElementById('progressBar').style.width = Math.round(done/total*100)+'%';

    // –æ—Ñ–∏—Å-—Ö–∏–Ω—Ç
    document.getElementById('officeHint').innerText = st.profile?.voivodeship ? officeHintByVoiv(st.profile.voivodeship) : '';

    st.tasks.forEach(t=>{
      const card = document.createElement('div');
      card.className='card';
      const badgeClass = t.status==='done'?'ok':(t.status==='inreview'?'warn':'');
      card.innerHTML = `
        <div class="row" style="align-items:center">
          <div style="flex:3">
            <h3 style="margin:0 0 6px">${t.title}</h3>
            <span class="badge ${badgeClass}">${t.status==='todo'?'To do':t.status==='inreview'?'In review':'Done'}</span>
            ${t.requiresAI?'<span class="small" style="margin-left:8px">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è AI-–ø—Ä–æ–≤–µ—Ä–∫–∞</span>':''}
          </div>
          <div style="flex:2">
            <div class="row">
              <button class="primary" onclick="openModule('${t.kind}')">–û—Ç–∫—Ä—ã—Ç—å</button>
              ${t.status!=='done'?'<button onclick="markDone(\''+t.id+'\')">–°–¥–µ–ª–∞–Ω–æ</button>':''}
            </div>
          </div>
        </div>
      `;
      tasksDiv.appendChild(card);
    });
  }

  function markDone(id){
    st.tasks = st.tasks.map(t=> t.id===id ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    renderChecklist();
  }

  // ===== –ù–∞–≤–∏–≥–∞—Ü–∏—è
  function openChecklist(){
    document.getElementById('onb').style.display = 'none';
    document.getElementById('home').style.display = 'block';
    renderChecklist();
  }

  function openModule(kind){
    // –ó–∞–≥–ª—É—à–∫–∏ –º–æ–¥—É–ª–µ–π (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
    if(kind==='aiTranslator'){
      alert('AI Translator: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–∏—Å—å–º–æ/–¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –ø–µ—Ä–µ–≤–æ–¥ –∏ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ. (–í MVP-–∑–∞–≥–ª—É—à–∫–µ –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—É—â–µ–Ω–∞)');
      return;
    }
    if(kind==='findSlot'){
      const dates = prompt('–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã/–¥–Ω–∏, –∫–æ–≥–¥–∞ –≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü–Ω/–°—Ä/–ü—Ç –∏–ª–∏ 20-25 –∞–≤–≥—É—Å—Ç–∞). –ú—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–º, –Ω–æ —Å–ª–æ—Ç –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.');
      alert('–°–ø–∞—Å–∏–±–æ! –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞.\n–í–∞—à–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–Ω–∏: '+(dates||'–Ω–µ —É–∫–∞–∑–∞–Ω–æ')+'\n–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞ ‚Äî –≤—Ä—É—á–Ω—É—é.');
      return;
    }
    if(kind==='bookAssistant'){
      const text = prompt('–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ, –æ —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å. –ó–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç-–∞–∫–∫–∞—É–Ω—Ç.');
      alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –û–ö, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.');
      if(tg && tg.openTelegramLink) tg.openTelegramLink('https://t.me/'+(tg.initDataUnsafe?.user?.username||''));
      return;
    }
    if(kind==='photos'){
      alert('–§–æ—Ç–æ: –≥–∞–π–¥ –ø–æ —Ä–∞–∑–º–µ—Ä—É/—Ñ–æ–Ω—É. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ (AI-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ MVP).');
      return;
    }
    if(kind==='insurance'){
      const has = confirm('–ï—Å—Ç—å –¥–µ–π—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞? –ù–∞–∂–º–∏—Ç–µ OK –µ—Å–ª–∏ –¥–∞, –û—Ç–º–µ–Ω–∞ –µ—Å–ª–∏ –ø–æ–∫–∞ –Ω–µ—Ç.');
      if(!has){
        alert('–ù–∞–∂–º–∏—Ç–µ ¬´–ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç¬ª, —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å, –∫–∞–∫ –æ—Ñ–æ—Ä–º–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É.');
        if(tg && tg.openTelegramLink) tg.openTelegramLink('https://t.me/'+(tg.initDataUnsafe?.user?.username||'')); // –∑–∞–≥–ª—É—à–∫–∞
      } else {
        alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–ª–∏—Å. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞: —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã.');
      }
      return;
    }
    if(kind==='wniosek'){
      const path = confirm('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫–∞–Ω –≤–Ω–µ—Å–∫–∞? (OK ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∞–Ω; –û—Ç–º–µ–Ω–∞ ‚Äî –ø—Ä–æ–π—Ç–∏ –∞–Ω–∫–µ—Ç—É –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF)');
      if(path){
        alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫–∞–Ω. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–¥–ø–∏—Å—å, –¥–∞—Ç—ã, —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –§–ò–û.');
      } else {
        alert('–û—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–Ω–∫–µ—Ç–∞ –≤–Ω–µ—Å–∫–∞ ‚Üí –∑–∞—Ç–µ–º –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å.');
      }
      return;
    }
    if(kind==='contract'){
      alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–≥–æ–≤–æ—Ä (UoP/UoD/UoZ/B2B). AI-–ø—Ä–æ–≤–µ—Ä–∫–∞: NIP, –¥–∞—Ç—ã, –ø–æ–¥–ø–∏—Å–∏. –ú–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—Ä—É—á–Ω—É—é.');
      return;
    }
    if(kind==='attachmentHR'){
      alert('–°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω, –æ—Ç–¥–∞–π—Ç–µ HR. –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π/—Å –ø–µ—á–∞—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç (AI-–ø—Ä–æ–≤–µ—Ä–∫–∞).');
      return;
    }
    if(kind==='rent'){
      alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã –∏–ª–∏ meldunek. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞: –∞–¥—Ä–µ—Å, —Å—Ä–æ–∫–∏, –ø–æ–¥–ø–∏—Å–∏. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫–∞–∂–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.');
      return;
    }
    if(kind==='university'){
      alert('–°–ø—Ä–∞–≤–∫–∞ –∏–∑ –≤—É–∑–∞: –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí AI-–ø—Ä–æ–≤–µ—Ä–∫–∞. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –≥–¥–µ –ø–æ–ª—É—á–∏—Ç—å.');
      return;
    }
    if(kind==='funds'){
      alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∞–Ω–∫–æ–≤—Å–∫—É—é —Å–ø—Ä–∞–≤–∫—É. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî —Å—É–º–º–∞/–¥–∞—Ç–∞/—Ä–µ–∫–≤–∏–∑–∏—Ç—ã.');
      return;
    }
    if(kind==='skarb'){
      const paid = confirm('–û–ø–ª–∞—Ç–∏–ª–∏ –≥–æ—Å–ø–æ—à–ª–∏–Ω—É? (OK ‚Äî –¥–∞; –û—Ç–º–µ–Ω–∞ ‚Äî –Ω–µ—Ç)');
      if(paid){
        alert('–û—Ç–º–µ—Ç–∏–ª–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ. (–ú–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —á–µ–∫ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤ MVP)');
      } else {
        alert('–ü–æ–∫–∞–∂–µ–º —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –∫–æ—Ä–æ—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –æ–ø–ª–∞—Ç–µ.');
      }
      return;
    }
  }

  // ===== –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (8 —à–∞–≥–æ–≤)
  function showQ(n){
    for(let i=1;i<=8;i++){ document.getElementById('q'+i).style.display = (i===n)?'':'none' }
    document.getElementById('step').innerText = String(n);
  }
  function prevQ(n){ showQ(n) }

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥
  function isAnswered(step){
    switch(step){
      case 1: {
        const fn = document.getElementById('firstName');
        const ln = document.getElementById('lastName');
        if(!fn.value.trim()){ fn.focus(); alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –∏–º—è.'); return false; }
        if(!ln.value.trim()){ ln.focus(); alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ —Ñ–∞–º–∏–ª–∏—é.'); return false; }
        return true;
      }
      case 2: {
        const s = document.getElementById('voivodeship');
        if(!s.value){ s.focus(); alert('–í—ã–±–µ—Ä–∏ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ.'); return false; }
        return true;
      }
      case 3: {
        const s = document.getElementById('citizenship');
        if(!s.value){ s.focus(); alert('–í—ã–±–µ—Ä–∏ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ.'); return false; }
        return true;
      }
      case 4: {
        const s = document.getElementById('stayLength');
        if(!s.value){ s.focus(); alert('–£–∫–∞–∂–∏ —Å—Ä–æ–∫ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è.'); return false; }
        return true;
      }
      case 5: {
        const s = document.getElementById('currentStatus');
        if(!s.value){ s.focus(); alert('–í—ã–±–µ—Ä–∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å.'); return false; }
        return true;
      }
      case 6: {
        const any = Array.from(document.querySelectorAll('.grounds')).some(el=>el.checked);
        if(!any){ alert('–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ.'); return false; }
        return true;
      }
      case 7: {
        const s = document.getElementById('income');
        if(!s.value){ s.focus(); alert('–£–∫–∞–∂–∏ –¥–æ—Ö–æ–¥.'); return false; }
        return true;
      }
      case 8: {
        const s = document.getElementById('goal');
        if(!s.value){ s.focus(); alert('–í—ã–±–µ—Ä–∏ —Ü–µ–ª—å.'); return false; }
        return true;
      }
      default: return true;
    }
  }

  function nextQValidated(curr, next){
    if(isAnswered(curr)){ showQ(next); }
  }

  function finishOnb(){
    // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —à–∞–≥–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
    for(let i=1;i<=8;i++){
      if(!isAnswered(i)){ showQ(i); return; }
    }

    // —Å–æ–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç—ã
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const voivodeship = document.getElementById('voivodeship').value;
    const citizenship = document.getElementById('citizenship').value;
    const stayLength = document.getElementById('stayLength').value;
    const currentStatus = document.getElementById('currentStatus').value;
    const income = document.getElementById('income').value;
    const goal = document.getElementById('goal').value;
    const grounds = Array.from(document.querySelectorAll('.grounds'))
      .filter(el=>el.checked)
      .map(el=>el.value);

    // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–µ–∫ –ø–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—è–º
    const track = determineTrack(grounds);
    const trackLabel = track==='work'?'–†–∞–±–æ—Ç–∞':track==='study'?'–£—á—ë–±–∞':track==='family'?'–°–µ–º—å—è':'–ë–∏–∑–Ω–µ—Å';

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    st.profile = { firstName, lastName, voivodeship, citizenship, stayLength, currentStatus, grounds, income, goal, track, trackLabel };
    localStorage.setItem('profile', JSON.stringify(st.profile));

    st.track = track;
    st.tasks = baseTasks(track);
    localStorage.setItem('track', track);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));

    document.getElementById('onb').style.display='none';
    document.getElementById('home').style.display='';
    renderChecklist();
  }

  // üîÑ –í—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–æ–≤: –æ—á–∏—â–∞–µ—Ç localStorage –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –∞–Ω–∫–µ—Ç–µ (—à–∞–≥ 1)
  function resetOnb(){
    if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –∞–Ω–∫–µ—Ç—É –∏ –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞?")){
      localStorage.removeItem('track');
      localStorage.removeItem('tasks');
      localStorage.removeItem('profile');
      st.track = null;
      st.tasks = [];
      st.profile = {};
      document.getElementById('home').style.display = 'none';
      document.getElementById('onb').style.display = '';
      showQ(1);
    }
  }

  // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
  (function init(){
    if(st.track){
      document.getElementById('onb').style.display='none';
      document.getElementById('home').style.display='';
      renderChecklist();
    } else {
      showQ(1);
    }
  })();
</script>
</body>
</html>
