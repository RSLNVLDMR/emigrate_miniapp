<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>eMigrant ‚Äî Miniapp MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#2563eb" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#1e293b;
      --muted:#64748b;
      --accent:#2563eb;
      --accent-light:#3b82f6;
      --line:#e2e8f0;
      --ok:#10b981;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px -1px rgba(0,0,0,0.1);
      --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -4px rgba(0,0,0,0.1);
    }
    
    *{box-sizing:border-box} 
    html,body{height:100%}
    
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      /* Telegram Mini App optimizations */
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      overflow-x: hidden;
    }
    
    .wrap{
      max-width:100%;
      margin:0 auto;
      padding:16px 16px 80px;
      padding-top:16px;
      /* Ensure content is visible */
      position: relative;
      z-index: 1;
    }
    
    /* –ö–æ–≥–¥–∞ —Ö–µ–¥–µ—Ä —Å–∫—Ä—ã—Ç, —É–±–∏—Ä–∞–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
    .wrap.no-header{padding-top:16px}
    
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
      transition:all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform:translateY(0);
      opacity:1;
      /* Ensure cards are visible in modals */
      position: relative;
      z-index: 1;
    }
    
    .card:hover{
      box-shadow:var(--shadow-lg);
      transform:translateY(-4px);
    }
    
    .card.animate-in{
      animation:slideInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }
    
    .card.animate-out{
      animation:slideOutDown 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }
    
    h1,h2,h3{
      margin:0 0 16px;
      font-weight:700;
      line-height:1.2;
    }
    
    h1{font-size:24px}
    h2{font-size:20px}
    h3{font-size:18px}
    
    header h2{
      margin:0;
      font-size:18px;
    }
    
    .small{color:var(--muted);font-size:14px;line-height:1.5}
    
    input,select,button,textarea{
      width:100%;
      padding:14px 16px;
      border-radius:12px;
      border:2px solid var(--line);
      background:var(--card);
      color:var(--text);
      margin-top:8px;
      font-size:16px;
      transition:all 0.2s ease;
      -webkit-appearance:none;
      -moz-appearance:none;
      appearance:none;
    }
    
    input:focus,select:focus,button:focus,textarea:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(37,99,235,0.1);
    }
    
    button{
      cursor:pointer;
      font-weight:600;
      transition:all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position:relative;
      overflow:hidden;
    }
    
    button::before{
      content:'';
      position:absolute;
      top:0;
      left:-100%;
      width:100%;
      height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);
      transition:left 0.5s;
    }
    
    button:hover::before{
      left:100%;
    }
    
    button.primary{
      background:linear-gradient(135deg,var(--accent),var(--accent-light));
      border-color:var(--accent);
      color:white;
      box-shadow:0 4px 16px 0 rgba(37,99,235,0.2);
      min-height:52px;
      font-weight:600;
      font-size:16px;
      letter-spacing:0.3px;
      transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      /* Telegram Mini App button optimizations */
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      /* Ensure buttons are visible */
      position: relative;
      z-index: 2;
    }
    
    button.primary:hover{
      transform:translateY(-3px);
      box-shadow:0 8px 25px 0 rgba(37,99,235,0.4);
      background:linear-gradient(135deg,var(--accent-light),var(--accent));
    }
    
    button.primary:active{
      transform:translateY(0);
      box-shadow:0 2px 8px 0 rgba(37,99,235,0.25);
    }
    
    button.ghost{
      background:transparent;
      border-color:var(--line);
      color:var(--text);
    }
    
    button.ghost:hover{
      background:var(--bg);
      border-color:var(--accent);
      transform:translateY(-1px);
    }
    
    button.ghost:active{
      transform:translateY(0);
    }
    
    .row{display:flex;gap:12px;align-items:center} 
    .row> *{flex:1}
    
    .progress{
      height:12px;
      background:var(--line);
      border-radius:999px;
      overflow:hidden;
      
    /* ====== Op≈Çata skarbowa ‚Äî —Å—Ç–∏–ª–∏ –º–æ–¥—É–ª—è */
    .oplata-field {
      margin-bottom: 16px;
    }
    
    .oplata-field label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
      font-size: 14px;
    }
    
    .copy-field {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--card);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--line);
    }
    
    .copy-text {
      flex: 1;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--text);
      word-break: break-all;
      line-height: 1.4;
    }
    
    .copy-btn {
      flex: 0 0 auto;
      width: auto;
      padding: 8px 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-height: auto;
      white-space: nowrap;
    }
    
    .copy-btn:hover {
      background: var(--accent-light);
      transform: scale(1.02);
    }
    
    .copy-btn:active {
      transform: scale(0.98);
    }
      box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .progress>span{
      display:block;
      height:100%;
      background:linear-gradient(90deg,var(--accent),var(--accent-light));
      border-radius:999px;
      transition:width 0.3s ease;
    }
    
    .badge{
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
      border:1px solid var(--line);
      color:var(--muted);
      background:var(--card);
    }
    
    .ok{color:var(--ok);border-color:var(--ok);background:rgba(16,185,129,0.1)}
    .warn{color:var(--warn);border-color:var(--warn);background:rgba(245,158,11,0.1)}
    
    #income_warning {
      border-left: 4px solid var(--warn);
      animation: pulse 2s infinite;
    }
    
    #income_warning .status {
      margin: 0;
    }
    
    .help-link{
      color:var(--accent);
      text-decoration:none;
      padding:8px 16px;
      border-radius:20px;
      background:rgba(37,99,235,0.08);
      border:1px solid rgba(37,99,235,0.15);
      transition:all 0.2s ease;
      display:inline-block;
    }
    
    .help-link:hover{
      background:rgba(37,99,235,0.12);
      border-color:rgba(37,99,235,0.25);
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(37,99,235,0.15);
    }
    
    button:disabled{
      opacity:0.4;
      cursor:not-allowed;
      transform:none !important;
    }
    
    button.primary:disabled{
      background:linear-gradient(135deg,#94a3b8,#cbd5e1);
      border-color:#94a3b8;
      color:#475569;
      box-shadow:0 2px 8px 0 rgba(148,163,184,0.2) !important;
    }
    
    .bottom{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      background:rgba(255,255,255,0.98);
      backdrop-filter:blur(20px);
      border-top:1px solid var(--line);
      display:flex;
      gap:6px;
      padding:12px 16px;
      box-shadow:0 -2px 16px rgba(0,0,0,0.1);
      z-index:1000;
      /* Telegram Mini App bottom menu optimizations */
      -webkit-backdrop-filter:blur(20px);
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    
    .bottom button{
      flex:1;
      border-radius:12px;
      padding:12px 8px;
      font-weight:600;
      font-size:13px;
      background:var(--card);
      border:1px solid var(--line);
      color:var(--text);
      transition:all 0.2s ease;
      min-height:44px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      /* Telegram Mini App button optimizations */
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    .bottom button:hover{
      background:var(--accent);
      color:white;
      border-color:var(--accent);
      transform:translateY(-1px);
    }
    
    header{
      position:sticky;
      top:0;
      background:rgba(255,255,255,0.98);
      backdrop-filter:blur(20px);
      z-index:1001;
      border-bottom:1px solid var(--line);
      padding:16px;
      box-shadow:0 1px 12px rgba(0,0,0,0.05);
      height:60px;
      box-sizing:border-box;
      display:none;
      align-items:center;
    }
    
    .hint{margin:12px 0 0;color:var(--muted)}
    
    /* modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      background:rgba(0,0,0,0.4);
      z-index:999;
      backdrop-filter:blur(4px);
      opacity:0;
      transition:opacity 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .modal.show{
      opacity:1;
    }
    
    .modal .sheet{
      width: calc(100vw - 32px);
      max-width: 480px;
      max-height: calc(100vh - 120px);
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 20px;
      padding: 20px;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      /* Positioning */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      /* Scrolling */
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      /* Layout */
      box-sizing: border-box;
      z-index: 1000;
    }
    
    .modal.show .sheet{
      transform:translate(-50%, -50%) scale(1);
      opacity:1;
    }
    
    /* Ensure all elements inside modal are visible */
    .modal .sheet * {
      position: relative;
      z-index: 1;
    }
    
    .modal .sheet button {
      z-index: 2;
    }
    
    .muted{color:var(--muted)} 
    .center{text-align:center}
    
    .danger{background:var(--danger);border-color:var(--danger);color:white}
    
    .hr{height:1px;background:var(--line);margin:16px 0}
    

    
    .spinner{
      width:32px;
      height:32px;
      border:3px solid var(--line);
      border-top-color:var(--accent);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin:16px auto;
    }
    
    @keyframes spin{to{transform:rotate(360deg)}}
    
    @keyframes slideInUp{
      from{
        opacity:0;
        transform:translateY(30px);
      }
      to{
        opacity:1;
        transform:translateY(0);
      }
    }
    
    @keyframes slideOutDown{
      from{
        opacity:1;
        transform:translateY(0);
      }
      to{
        opacity:0;
        transform:translateY(30px);
      }
    }
    
    @keyframes pulse{
      0%, 100%{
        transform:scale(1);
        box-shadow:0 0 0 0 rgba(37,99,235,0.1);
      }
      50%{
        transform:scale(1.02);
        box-shadow:0 0 0 10px rgba(37,99,235,0.1);
      }
    }
    

    
    @keyframes fadeIn{
      from{
        opacity:0;
        transform:translateY(10px);
      }
      to{
        opacity:1;
        transform:translateY(0);
      }
    }
    
    @keyframes slideInRight{
      from{
        opacity:0;
        transform:translateX(30px);
      }
      to{
        opacity:1;
        transform:translateX(0);
      }
    }
    

    
    .status{
      padding:16px;
      border-radius:16px;
      border:1px solid var(--line);
      background:var(--bg);
      box-shadow:var(--shadow);
    }
    
    .completion-info{
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      box-shadow:var(--shadow);
    }
    
    .status.ok{
      border-color:var(--ok);
      background:rgba(16,185,129,0.05);
    }
    
    .status.err{
      border-color:var(--danger);
      background:rgba(239,68,68,0.05);
    }
    
    /* Payment styles */
    .payment-details{margin:20px 0}
    .payment-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 0;
      border-bottom:1px solid var(--line);
    }
    
    .payment-item:last-child{border-bottom:none}
    
    .payment-price{font-weight:700;color:var(--accent);font-size:15px}
    .payment-price.total{font-size:18px;color:var(--ok)}
    
    /* Photo module styles */
    .photo-requirements{margin:16px 0}
    .requirement-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px 0;
      border-bottom:1px solid var(--line);
    }
    
    .requirement-item:last-child{border-bottom:none}
    
    .requirement-value{
      font-weight:700;
      color:var(--accent);
      font-size:15px;
    }
    
    .photo-studios{margin:16px 0}
    .studio-item{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      margin-bottom:10px;
      box-shadow:var(--shadow);
      transition:all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform:translateY(0);
      opacity:1;
    }
    
    .studio-item:hover{
      box-shadow:var(--shadow-lg);
      transform:translateY(-2px);
    }
    
    .studio-item:nth-child(1){animation:fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.1s both}
    .studio-item:nth-child(2){animation:fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s both}
    .studio-item:nth-child(3){animation:fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.3s both}
    
    .studio-info h4{
      margin:0 0 8px;
      color:var(--text);
      font-size:15px;
      font-weight:700;
    }
    
    .studio-details{
      display:flex;
      flex-direction:column;
      gap:3px;
      margin-bottom:10px;
    }
    
    .studio-details span{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:4px;
    }
    
    .studio-actions{
      display:flex;
      gap:6px;
    }
    
    .studio-actions button{
      flex:1;
      padding:8px 10px;
      border-radius:10px;
      font-weight:600;
      font-size:13px;
    }
    
    /* Mobile optimizations */
    @media (max-width: 480px) {
      .wrap {
        padding: 16px 12px 80px;
      }
      
      .wrap.no-header {
        padding: 12px 12px 80px;
      }
      
      .card {
        padding: 16px;
        margin-bottom: 10px;
        border-radius: 14px;
      }
      
      h1 { font-size: 22px; }
      h2 { font-size: 18px; }
      h3 { font-size: 16px; }
      
      header {
        height: 56px;
        padding: 12px;
        display: none;
      }
      
      header h2 {
        margin: 0;
        font-size: 16px;
      }
      
      input, select, button, textarea {
        padding: 12px 14px;
        border-radius: 10px;
        font-size: 16px;
      }
      

      
      .status {
        padding: 14px;
        border-radius: 14px;
      }
      
      .photo-studios {
        margin: 12px 0;
      }
      
      .studio-item {
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 12px;
      }
      
      .studio-info h4 {
        font-size: 14px;
        margin: 0 0 6px;
      }
      
      .studio-details {
        gap: 2px;
        margin-bottom: 8px;
      }
      
      .studio-details span {
        font-size: 11px;
      }
      
      .studio-actions button {
        padding: 8px;
        font-size: 12px;
        border-radius: 8px;
      }
      
      .photo-requirements {
        margin: 12px 0;
      }
      
      .requirement-item {
        padding: 6px 0;
      }
      
      .bottom {
        padding: 8px 12px;
      }
      
      .bottom button {
        min-height: 40px;
        font-size: 12px;
        padding: 8px 6px;
      }
      }
      
      /* Extra small screens optimization */
      @media (max-width: 375px) {
        .studio-item {
          padding: 10px;
          margin-bottom: 6px;
        }
        
        .studio-info h4 {
          font-size: 13px;
        }
        
        .studio-details span {
          font-size: 10px;
        }
        
        .studio-actions button {
          padding: 6px 8px;
          font-size: 11px;
        }
        
        .photo-requirements {
          margin: 8px 0;
        }
        
        .requirement-item {
          padding: 4px 0;
      }
      
      .modal .sheet {
        width: calc(100vw - 24px);
        max-height: calc(100vh - 100px);
        padding: 16px;
        border-radius: 16px;
        transform: translate(-50%, -50%) scale(0.95);
      }
      
      .bottom {
        padding: 10px 12px;
        gap: 4px;
      }
      
      .bottom button {
        padding: 10px 6px;
        font-size: 12px;
        min-height: 40px;
      }
      
      .row {
        gap: 8px;
      }
      
      .payment-item, .requirement-item {
        padding: 8px 0;
      }
      
      .studio-item {
        padding: 14px;
        margin-bottom: 10px;
        border-radius: 14px;
      }
      
      .studio-actions {
        gap: 6px;
      }
      
      .studio-actions button {
        padding: 8px;
        font-size: 13px;
      }
      
      .custom-checkbox {
        padding: 10px;
        gap: 10px;
        border-radius: 10px;
        margin-bottom: 6px;
      }
      
      .custom-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
      }
      
      .custom-checkbox-text {
        font-size: 15px;
      }
    }
    
    /* Custom checkbox styles */
    .custom-checkbox {
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 2px solid var(--line);
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--card);
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      /* Ensure the entire area is clickable */
      min-height: 44px;
      /* Prevent text selection */
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .custom-checkbox:hover {
      border-color: var(--accent);
      background: rgba(37, 99, 235, 0.02);
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }
    
    .custom-checkbox.checked {
      border-color: var(--accent);
      background: rgba(37, 99, 235, 0.08);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15);
    }
    
    .custom-checkbox:active {
      transform: translateY(0);
      box-shadow: 0 1px 4px rgba(37, 99, 235, 0.1);
    }
    
    .custom-checkbox:focus-within {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    
    .custom-checkbox input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin: 0;
      appearance: none;
      border: 2px solid var(--line);
      border-radius: 4px;
      background: var(--card);
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      /* Ensure checkbox doesn't interfere with label clicks */
      pointer-events: none;
      /* Make it visually integrated */
      flex-shrink: 0;
    }
    
    .custom-checkbox input[type="checkbox"]:checked {
      background: var(--accent);
      border-color: var(--accent);
    }
    
    .custom-checkbox input[type="checkbox"]:checked::before {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    
    .custom-checkbox-text {
      flex: 1;
      font-size: 16px;
      color: var(--text);
    }
    
    .custom-checkbox.checked .custom-checkbox-text {
      color: var(--accent);
      font-weight: 600;
    }
    
    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      button {
        min-height: 44px;
      }
      
      .custom-checkbox {
        min-height: 48px;
        padding: 14px;
      }
      
      .custom-checkbox:active {
        transform: scale(0.98);
        background: rgba(37, 99, 235, 0.12);
      }
      
      .card:hover {
        transform: none;
      }
      
      .studio-item:hover {
        transform: none;
      }
      
      button.primary:hover {
        transform: none;
      }
      
      button.ghost:hover {
        transform: none;
      }
      
      .custom-checkbox:hover {
        border-color: var(--line);
        background: var(--card);
        transform: none;
        box-shadow: none;
      }
      
      .custom-checkbox:active {
        transform: none;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <header><h2 id="title">eMigrant ¬∑ –û–Ω–±–æ—Ä–¥–∏–Ω–≥</h2></header>

  <!-- –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (8 –≤–æ–ø—Ä–æ—Å–æ–≤) -->
  <div id="onb" class="card">
    <div class="badge">–®–∞–≥ <span id="step">1</span>/8</div>

    <!-- Q1 -->
    <div id="q1">
      <h3>1) –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</h3>
      <label>–ò–º—è</label>
      <input id="firstName" placeholder="–ò–º—è" autocomplete="given-name"/>
      <label>–§–∞–º–∏–ª–∏—è</label>
      <input id="lastName" placeholder="–§–∞–º–∏–ª–∏—è" autocomplete="family-name"/>
      <div class="row" style="margin-top:16px">
        <span></span>
        <button class="primary" onclick="nextQValidated(1,2)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q2 -->
    <div id="q2" style="display:none">
      <h3>2) –ú–µ—Å—Ç–æ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
      <select id="voivodeship">
        <option value="Mazowieckie">Mazowieckie</option>
        <option value="Ma≈Çopolskie">Ma≈Çopolskie</option>
        <option value="Pomorskie">Pomorskie</option>
        <option value="Dolno≈õlƒÖskie">Dolno≈õlƒÖskie</option>
        <option value="Kujawsko-Pomorskie">Kujawsko-Pomorskie</option>
        <option value="Lubelskie">Lubelskie</option>
        <option value="Lubuskie">Lubuskie</option>
        <option value="≈Å√≥dzkie">≈Å√≥dzkie</option>
        <option value="Opolskie">Opolskie</option>
        <option value="Podkarpackie">Podkarpackie</option>
        <option value="Podlaskie">Podlaskie</option>
        <option value="≈ölƒÖskie">≈ölƒÖskie</option>
        <option value="≈öwiƒôtokrzyskie">≈öwiƒôtokrzyskie</option>
        <option value="Warmi≈Ñsko-Mazurskie">Warmi≈Ñsko-Mazurskie</option>
        <option value="Wielkopolskie">Wielkopolskie</option>
        <option value="Zachodniopomorskie">Zachodniopomorskie</option>
        <option value="Inne">Inne</option>
      </select>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(1)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(2,3)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q3 -->
    <div id="q3" style="display:none">
      <h3>3) –ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ</h3>
      <select id="citizenship">
        <option value="UKR">–£–∫—Ä</option>
        <option value="BLR">–ë–µ–ª</option>
        <option value="RUS">–†—É—Å</option>
        <option value="Other">–î—Ä—É–≥–æ–µ</option>
      </select>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(2)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(3,4)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q4 -->
    <div id="q4" style="display:none">
      <h3>4) –í—Ä–µ–º—è –≤ –ü–æ–ª—å—à–µ</h3>
      <select id="stayLength">
        <option value="2-3">2‚Äì3 –≥–æ–¥–∞</option>
        <option value="<=1">–≥–æ–¥ –∏ –º–µ–Ω—å—à–µ</option>
        <option value=">=4">–±–æ–ª—å—à–µ 4 –ª–µ—Ç</option>
        <option value="new">—Ç–æ–ª—å–∫–æ –ø—Ä–∏–µ—Ö–∞–ª</option>
      </select>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(3)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(4,5)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q5 -->
    <div id="q5" style="display:none">
      <h3>5) –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h3>
      <select id="currentStatus">
        <option value="waiting">–ñ–¥—É</option>
        <option value="refused">–ü–æ–ª—É—á–∏–ª –æ—Ç–∫–∞–∑</option>
        <option value="statusUKR">Status UKR</option>
        <option value="pobytCzasowy">Pobyt Czasowy</option>
        <option value="other">Inne (Karta Polaka, Karta Rezydenta UE)</option>
      </select>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(4)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(5,6)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q6 -->
    <div id="q6" style="display:none">
      <h3>6) –û—Å–Ω–æ–≤–∞–Ω–∏—è –¥–ª—è –í–ù–ñ</h3>
      <div class="small">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ.</div>
      <div style="margin:16px 0">
        <label class="custom-checkbox" data-value="UoP">
          <input type="checkbox" class="grounds" value="UoP" onchange="checkIncomeWarning()">
          <span class="custom-checkbox-text">–†–∞–±–æ—Ç–∞ (UoP)</span>
        </label>
        <label class="custom-checkbox" data-value="UoD">
          <input type="checkbox" class="grounds" value="UoD" onchange="checkIncomeWarning()">
          <span class="custom-checkbox-text">–†–∞–±–æ—Ç–∞ (UoD)</span>
        </label>
        <label class="custom-checkbox" data-value="UoZ">
          <input type="checkbox" class="grounds" value="UoZ" onchange="checkIncomeWarning()">
          <span class="custom-checkbox-text">–†–∞–±–æ—Ç–∞ (UoZ)</span>
        </label>
        <label class="custom-checkbox" data-value="Dzialalnosc">
          <input type="checkbox" class="grounds" value="Dzialalnosc">
          <span class="custom-checkbox-text">–†–∞–±–æ—Ç–∞ (Dzia≈Çalno≈õƒá)</span>
        </label>
        <label class="custom-checkbox" data-value="Study">
          <input type="checkbox" class="grounds" value="Study">
          <span class="custom-checkbox-text">–£—á—ë–±–∞</span>
        </label>
        <label class="custom-checkbox" data-value="Family">
          <input type="checkbox" class="grounds" value="Family">
          <span class="custom-checkbox-text">–°–µ–º—å—è</span>
        </label>
      </div>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(5)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(6,7)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q7 -->
    <div id="q7" style="display:none">
      <h3>7) –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ (brutto)</h3>
      <select id="income" onchange="checkIncomeWarning()">
        <option value="<4666">–¥–æ 4666</option>
        <option value="4666-10000">4666‚Äì10000</option>
        <option value=">10000">10000+</option>
      </select>
      
      <div id="income_warning" class="status warn" style="display:none;margin-top:12px">
        <div style="text-align:center">
          <div style="font-size:20px;margin-bottom:8px">‚ö†Ô∏è</div>
          <div><strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –° –¥–æ—Ö–æ–¥–æ–º –Ω–∏–∂–µ 4666 PLN —Ç—ã –Ω–µ —Å–º–æ–∂–µ—à—å –ø–æ–¥–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É –ø–æ —Ä–∞–±–æ—Ç–µ.</div>
          <div style="margin-top:8px;font-size:14px">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥.</div>
        </div>
      </div>
      
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(6)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="nextQValidated(7,8)">–î–∞–ª–µ–µ</button>
      </div>
    </div>

    <!-- Q8 -->
    <div id="q8" style="display:none">
      <h3>8) –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Ü–µ–ª—å –≤ –ü–æ–ª—å—à–µ</h3>
      <select id="goal">
        <option value="wait">–ü–µ—Ä–µ–∂–¥–∞—Ç—å –±—É—Ä—é</option>
        <option value="euResidentMaybe">–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Ç–∞, –Ω–æ –Ω–∞—Å—á—ë—Ç –ø–∞—Å–ø–æ—Ä—Ç–∞ –Ω–µ—É–≤–µ—Ä–µ–Ω</option>
        <option value="passport">–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç</option>
      </select>
      <div class="row" style="margin-top:16px">
        <button onclick="prevQ(7)">–ù–∞–∑–∞–¥</button>
        <button class="primary" onclick="finishOnb()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div class="small" style="margin-top:8px">PDF –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ</div>
    </div>
  </div>

  <!-- –ß–µ–∫–ª–∏—Å—Ç -->
  <div id="home" style="display:none">
    <div class="card">
      <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
      <div class="progress"><span id="progressBar" style="width:0%"></span></div>
      <div class="small" style="margin-top:6px">–ì–æ—Ç–æ–≤–æ: <span id="doneCount">0</span>/<span id="totalCount">0</span></div>
      <div id="officeHint" class="small hint"></div>
    </div>

    <div id="tasks"></div>

    <!-- üîÑ –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ -->
    <div style="margin-top:16px; text-align:center">
      <button onclick="resetOnb()">üîÑ Reset (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)</button>
    </div>
  </div>
</div>

<!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<div class="bottom">
  <button onclick="openChecklist()">Checklist</button>
  <button onclick="openModule('aiTranslator')">AI Translator</button>
  <button onclick="openModule('slot')">Book a slot</button>
  <button onclick="openModule('bookAssistant')">Start a chat</button>
</div>

<!-- ====== –ö–æ–Ω—Ç—Ä–∞–∫—Ç/–û—Å–Ω–æ–≤–∞–Ω–∏–µ ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closeModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: –∑–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="ct_step1">
      <h3>–ó–∞–≥—Ä—É–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
      <div class="small">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PDF, JPG, PNG (–¥–æ ~20 –ú–ë).</div>
      <div id="ct_checked_info" class="status ok" style="display:none;margin-top:10px"></div>
      <input id="ct_file" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" />
      <div class="hr"></div>
      <button id="ct_btn_upload" class="primary" disabled onclick="ctStart()">
        <span style="display:flex;align-items:center;justify-content:center;gap:8px">
          <span style="font-size:18px">ü§ñ</span>
          <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å AI</span>
        </span>
      </button>
      <div class="small muted" style="margin-top:12px;text-align:center">
        <a href="javascript:void(0)" onclick="ctNoDoc()" class="help-link">–£ –º–µ–Ω—è –Ω–µ—Ç ‚Äî –ø–æ–º–æ–≥–∏—Ç–µ</a>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 2: –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ -->
    <div id="ct_step2" style="display:none">
      <h3>AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω</h3>
      <div class="completion-info" style="margin:20px 0;text-align:center">
        <div style="font-size:48px;margin-bottom:16px">‚è∞</div>
        <div style="font-size:18px;font-weight:600;margin-bottom:8px">–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤</div>
        <div id="ct_completion_date" style="font-size:24px;color:var(--accent);font-weight:700;margin-bottom:8px"></div>
        <div id="ct_completion_time" style="font-size:16px;color:var(--muted)"></div>
      </div>
      <div class="status" id="ct_queue_msg" style="margin-top:16px">
        –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ <span id="ct_time_remaining">—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</span>
      </div>
      <div class="small muted" style="margin-top:12px">
        –ú–æ–∂–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å AI –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã—Å—Ç—Ä–µ–µ
      </div>
      <div style="margin-top:20px">
        <button id="ct_btn_boost" class="primary" onclick="ctBoost()" style="width:100%">–£—Å–∫–æ—Ä—è—é!</button>
      </div>
      <div class="small muted" id="ct_poll_note" style="margin-top:8px"></div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 3: –æ–ø–ª–∞—Ç–∞ -->
    <div id="ct_step3" style="display:none">
      <h3>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</h3>
      <div class="status" style="margin-top:16px">
        <div class="center">
          <div style="font-size:24px;color:var(--accent);margin-bottom:8px">‚ö°</div>
          <div>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 1 —á–∞—Å –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div class="payment-details">
        <div class="payment-item">
          <span>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</span>
          <span class="payment-price">50 PLN</span>
        </div>
        <div class="payment-item">
          <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</span>
          <span class="payment-price">+20 PLN</span>
        </div>
        <div class="hr"></div>
        <div class="payment-total">
          <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
          <span class="payment-price total">70 PLN</span>
        </div>
      </div>
      
      <div style="margin-top:20px">
        <button class="primary" onclick="ctProcessPayment()" style="width:100%;margin-bottom:12px">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        <button class="ghost" onclick="ctBackToTimer()" style="width:100%">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 4: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="ct_step4" style="display:none">
      <h3 id="ct_result_title">–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ</h3>
      <div id="ct_result_box" class="status ok" style="margin-top:10px">
        <div id="ct_result_text">–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>
      </div>
      <div style="margin-top:20px">
        <button class="primary" onclick="ctBackToHome()" style="width:100%;margin-bottom:12px">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        <button class="ghost" onclick="ctStartOver()" style="width:100%">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Za≈ÇƒÖcznik od pracodawcy ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="za≈ÇƒÖcznik_modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closeZa≈ÇƒÖcznikModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ -->
    <div id="za≈ÇƒÖcznik_step1">
      <h3>–°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞</h3>
      <div class="small">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ –∏ —Å–∫–∞—á–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —à–∞–±–ª–æ–Ω</div>
      
      <div class="small muted" style="margin: 16px 0; padding: 12px; background: var(--bg); border-radius: 8px;">
        <div style="margin-bottom: 8px;">üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</div>
        <div style="font-size: 13px; line-height: 1.4;">
          1. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞<br>
          2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω"<br>
          3. –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ
        </div>
      </div>
      

      
      <div class="voivodeship-select" style="margin: 20px 0">
        <label for="za≈ÇƒÖcznik_voivodeship" style="display: block; margin-bottom: 8px; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ:</label>
        <select id="za≈ÇƒÖcznik_voivodeship" onchange="za≈ÇƒÖcznikUpdateTemplate()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ...</option>
          <option value="Dolno≈õlƒÖskie">–ù–∏–∂–Ω–µ—Å–∏–ª–µ–∑—Å–∫–æ–µ</option>
          <option value="Kujawsko-Pomorskie">–ö—É—è–≤—Å–∫–æ-–ü–æ–º–æ—Ä—Å–∫–æ–µ</option>
          <option value="Lubelskie">–õ—é–±–ª–∏–Ω—Å–∫–æ–µ</option>
          <option value="Lubuskie">–õ—é–±—É—Å–∫–æ–µ</option>
          <option value="≈Å√≥dzkie">–õ–æ–¥–∑–∏–Ω—Å–∫–æ–µ</option>
          <option value="Ma≈Çopolskie">–ú–∞–ª–æ–ø–æ–ª—å—Å–∫–æ–µ</option>
          <option value="Mazowieckie">–ú–∞–∑–æ–≤–µ—Ü–∫–æ–µ</option>
          <option value="Opolskie">–û–ø–æ–ª—å—Å–∫–æ–µ</option>
          <option value="Podkarpackie">–ü–æ–¥–∫–∞—Ä–ø–∞—Ç—Å–∫–æ–µ</option>
          <option value="Podlaskie">–ü–æ–¥–ª—è—Å–∫–æ–µ</option>
          <option value="Pomorskie">–ü–æ–º–æ—Ä—Å–∫–æ–µ</option>
          <option value="≈ölƒÖskie">–°–∏–ª–µ–∑—Å–∫–æ–µ</option>
          <option value="≈öwiƒôtokrzyskie">–°–≤–µ–Ω—Ç–æ–∫—à–∏—Å–∫–æ–µ</option>
          <option value="Warmi≈Ñsko-Mazurskie">–í–∞—Ä–º–∏–Ω—å—Å–∫–æ-–ú–∞–∑—É—Ä—Å–∫–æ–µ</option>
          <option value="Wielkopolskie">–í–µ–ª–∏–∫–æ–ø–æ–ª—å—Å–∫–æ–µ</option>
          <option value="Zachodniopomorskie">–ó–∞–ø–∞–¥–Ω–æ-–ü–æ–º–æ—Ä—Å–∫–æ–µ</option>
        </select>
        
        <div class="small muted" style="margin-top: 8px; padding: 8px; background: var(--bg); border-radius: 6px;">
          <div style="margin-bottom: 4px;">üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã:</div>
          <div style="font-size: 12px; line-height: 1.4;">
            ‚úÖ –ù–∏–∂–Ω–µ—Å–∏–ª–µ–∑—Å–∫–æ–µ, –õ—é–±–ª–∏–Ω—Å–∫–æ–µ, –õ–æ–¥–∑–∏–Ω—Å–∫–æ–µ, –ú–∞–ª–æ–ø–æ–ª—å—Å–∫–æ–µ, –ú–∞–∑–æ–≤–µ—Ü–∫–æ–µ, –û–ø–æ–ª—å—Å–∫–æ–µ, –ü–æ–¥–∫–∞—Ä–ø–∞—Ç—Å–∫–æ–µ, –°–≤–µ–Ω—Ç–æ–∫—à–∏—Å–∫–æ–µ, –í–µ–ª–∏–∫–æ–ø–æ–ª—å—Å–∫–æ–µ<br>
            ‚è≥ –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ú–∞–∑–æ–≤–µ—Ü–∫–∏–π —à–∞–±–ª–æ–Ω
          </div>
        </div>
      </div>
      
              <div id="za≈ÇƒÖcznik_template_info" style="display:none" class="template-info">
          <div class="template-details" style="background: var(--bg); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
            <h4 style="margin: 0 0 12px 0;">–®–∞–±–ª–æ–Ω –¥–ª—è <span id="za≈ÇƒÖcznik_voiv_name"></span></h4>
            <p style="margin: 8px 0;">–§–∞–π–ª: <span id="za≈ÇƒÖcznik_template_file"></span></p>
            <p style="margin: 8px 0;">–†–∞–∑–º–µ—Ä: <span id="za≈ÇƒÖcznik_template_size"></span></p>
          </div>
          
          <div id="za≈ÇƒÖcznik_availability_warning" style="display:none; margin-bottom: 16px; padding: 12px; background: var(--warn); color: white; border-radius: 8px; text-align: center;">
            <div class="small" style="margin-bottom: 8px;">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ</div>
            <div class="small">–®–∞–±–ª–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω –ú–∞–∑–æ–≤–µ—Ü–∫–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞.</div>
          </div>
          
          <button id="za≈ÇƒÖcznik_btn_download" class="primary" onclick="za≈ÇƒÖcznikDownloadTemplate()">
            <span style="display:flex;align-items:center;justify-content:center;gap:8px">
              <span style="font-size:18px">üì•</span>
              <span>–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</span>
            </span>
          </button>
          
                  <div id="za≈ÇƒÖcznik_download_status" style="display:none; margin-top: 12px; padding: 12px; background: var(--bg); border-radius: 8px; text-align: center;">
          <div class="small" style="margin-bottom: 8px;">–°—Ç–∞—Ç—É—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</div>
          <div id="za≈ÇƒÖcznik_status_text" class="small muted">–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª...</div>
          

        </div>
          
                  <div id="za≈ÇƒÖcznik_manual_download" style="display:none; margin-top: 12px;">
          <div class="small muted" style="margin-bottom: 8px;">–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</div>
          <a id="za≈ÇƒÖcznik_manual_link" href="#" target="_blank" class="ghost" style="display: inline-block; text-decoration: none; padding: 8px 16px; border: 1px solid var(--line); border-radius: 8px;">
            <span style="display:flex;align-items:center;justify-content:center;gap:8px">
              <span style="font-size:16px">üîó</span>
              <span>–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</span>
            </span>
          </a>
          
          <div class="small muted" style="margin-top: 8px; padding: 8px; background: var(--bg); border-radius: 6px;">
            <div style="margin-bottom: 4px;">üîß –†–µ—à–µ–Ω–∏–µ:</div>
            <div style="font-size: 12px; line-height: 1.4;">
              –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –≤—ã—à–µ, –∑–∞—Ç–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –Ω–∞–∂–º–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –Ω–∞ PDF –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫..."
            </div>
          </div>
          
          <div class="small muted" style="margin-top: 8px; padding: 8px; background: var(--bg); border-radius: 6px;">
            <div style="margin-bottom: 4px;">üì± –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö:</div>
            <div style="font-size: 12px; line-height: 1.4;">
              –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å—Å—ã–ª–∫—É, –≤—ã–±–µ—Ä–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –∫–∞–∫..."
            </div>
          </div>
          
          <div class="small muted" style="margin-top: 8px; padding: 8px; background: var(--bg); border-radius: 6px;">
            <div style="margin-bottom: 4px;">‚úÖ –£–ª—É—á—à–µ–Ω–∏—è:</div>
            <div style="font-size: 12px; line-height: 1.4;">
              –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ URL –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å—Å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
            </div>
          </div>
          

        </div>
        </div>
      

    </div>

    <!-- —ç–∫—Ä–∞–Ω 2: –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –ø–æ—á—Ç–µ -->
    <div id="za≈ÇƒÖcznik_step2" style="display:none">
      <h3>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞—á–∞–ª—å–Ω–∏–∫—É</h3>
      <div class="small">–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–æ –ø–æ—á—Ç–µ –≤–∞—à–µ–º—É –Ω–∞—á–∞–ª—å–Ω–∏–∫—É –¥–ª—è –ø–æ–¥–ø–∏—Å–∏</div>
      
      <div class="email-info" style="background: var(--bg); padding: 16px; border-radius: 12px; margin: 20px 0;">
        <h4 style="margin: 0 0 12px 0;">üìß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—Ç–ø—Ä–∞–≤–∫–µ:</h4>
        <ol style="margin: 0; padding-left: 20px;">
          <li>–°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —à–∞–±–ª–æ–Ω</li>
          <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –ø–æ email –≤–∞—à–µ–º—É –Ω–∞—á–∞–ª—å–Ω–∏–∫—É</li>
          <li>–ü–æ–ø—Ä–æ—Å–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</li>
          <li>–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞—Ç–Ω–æ</li>
        </ol>
      </div>
      
      <div class="hr"></div>
      
      <div class="upload-section">
        <h4>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è AI –ø—Ä–æ–≤–µ—Ä–∫–∏</h4>
        <div class="small">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PDF, JPG, PNG (–¥–æ ~20 –ú–ë)</div>
        <input id="za≈ÇƒÖcznik_file" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" style="margin: 16px 0;" />
        
        <button id="za≈ÇƒÖcznik_btn_upload" class="primary" disabled onclick="za≈ÇƒÖcznikStart()">
          <span style="display:flex;align-items:center;justify-content:center;gap:8px">
            <span style="font-size:18px">ü§ñ</span>
            <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å AI</span>
          </span>
        </button>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 3: AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω -->
    <div id="za≈ÇƒÖcznik_step3" style="display:none">
      <h3>AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω</h3>
      <div class="completion-info" style="margin:20px 0;text-align:center">
        <div style="font-size:48px;margin-bottom:16px">‚è∞</div>
        <div style="font-size:18px;font-weight:600;margin-bottom:8px">–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤</div>
        <div id="za≈ÇƒÖcznik_completion_date" style="font-size:24px;color:var(--accent);font-weight:700;margin-bottom:8px"></div>
        <div id="za≈ÇƒÖcznik_completion_time" style="font-size:16px;color:var(--muted)"></div>
      </div>
      <div class="status" id="za≈ÇƒÖcznik_queue_msg" style="margin-top:16px">
        –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ <span id="za≈ÇƒÖcznik_time_remaining">—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</span>
      </div>
      <div class="small muted" style="margin-top:12px">
        –ú–æ–∂–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å AI –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã—Å—Ç—Ä–µ–µ
      </div>
      <div style="margin-top:20px">
        <button id="za≈ÇƒÖcznik_btn_boost" class="primary" onclick="za≈ÇƒÖcznikBoost()" style="width:100%">–£—Å–∫–æ—Ä—è—é!</button>
      </div>
      <div class="small muted" id="za≈ÇƒÖcznik_poll_note" style="margin-top:8px"></div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 4: –æ–ø–ª–∞—Ç–∞ -->
    <div id="za≈ÇƒÖcznik_step4" style="display:none">
      <h3>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</h3>
      <div class="status" style="margin-top:16px">
        <div class="center">
          <div style="font-size:24px;color:var(--accent);margin-bottom:8px">‚ö°</div>
          <div>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 1 —á–∞—Å –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div class="payment-details">
        <div class="payment-item">
          <span>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</span>
          <span class="payment-price">50 PLN</span>
        </div>
        <div class="payment-item">
          <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</span>
          <span class="payment-price">+20 PLN</span>
        </div>
        <div class="hr"></div>
        <div class="payment-total">
          <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
          <span class="payment-price total">70 PLN</span>
        </div>
      </div>
      
      <div style="margin-top:20px">
        <button class="primary" onclick="za≈ÇƒÖcznikProcessPayment()" style="width:100%;margin-bottom:12px">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        <button class="ghost" onclick="za≈ÇƒÖcznikBackToTimer()" style="width:100%">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
    
    <!-- —ç–∫—Ä–∞–Ω 5: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="za≈ÇƒÖcznik_step5" style="display:none">
      <h3 id="za≈ÇƒÖcznik_result_title">–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ</h3>
      <div id="za≈ÇƒÖcznik_result_box" class="status ok" style="margin-top:10px">
        <div id="za≈ÇƒÖcznik_result_text">–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>
      </div>
      <div style="margin-top:20px">
        <button class="primary" onclick="za≈ÇƒÖcznikBackToHome()" style="width:100%;margin-bottom:12px">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        <button class="ghost" onclick="za≈ÇƒÖcznikStartOver()" style="width:100%">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Op≈Çata skarbowa ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="oplata_modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closeOplataModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: –≤—ã–±–æ—Ä –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞ -->
    <div id="oplata_step1">
      <h3>Op≈Çata skarbowa - –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã</h3>
      <div class="small">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –æ–ø–ª–∞—Ç—ã</div>
      
      <div class="voivodeship-select" style="margin: 20px 0">
        <label for="oplata_voivodeship" style="display: block; margin-bottom: 8px; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ:</label>
        <select id="oplata_voivodeship" onchange="oplataUpdateData()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ...</option>
          <option value="Dolno≈õlƒÖskie">–ù–∏–∂–Ω–µ—Å–∏–ª–µ–∑—Å–∫–æ–µ (Dolno≈õlƒÖskie)</option>
          <option value="Kujawsko-Pomorskie">–ö—É—è–≤—Å–∫–æ-–ü–æ–º–æ—Ä—Å–∫–æ–µ (Kujawsko-Pomorskie)</option>
          <option value="Lubelskie">–õ—é–±–ª–∏–Ω—Å–∫–æ–µ (Lubelskie)</option>
          <option value="Lubuskie">–õ—é–±—É—Å–∫–æ–µ (Lubuskie)</option>
          <option value="≈Å√≥dzkie">–õ–æ–¥–∑–∏–Ω—Å–∫–æ–µ (≈Å√≥dzkie)</option>
          <option value="Ma≈Çopolskie">–ú–∞–ª–æ–ø–æ–ª—å—Å–∫–æ–µ (Ma≈Çopolskie)</option>
          <option value="Mazowieckie">–ú–∞–∑–æ–≤–µ—Ü–∫–æ–µ (Mazowieckie)</option>
          <option value="Opolskie">–û–ø–æ–ª—å—Å–∫–æ–µ (Opolskie)</option>
          <option value="Podkarpackie">–ü–æ–¥–∫–∞—Ä–ø–∞—Ç—Å–∫–æ–µ (Podkarpackie)</option>
          <option value="Podlaskie">–ü–æ–¥–ª—è—Å–∫–æ–µ (Podlaskie)</option>
          <option value="Pomorskie">–ü–æ–º–æ—Ä—Å–∫–æ–µ (Pomorskie)</option>
          <option value="≈ölƒÖskie">–°–∏–ª–µ–∑—Å–∫–æ–µ (≈ölƒÖskie)</option>
          <option value="≈öwiƒôtokrzyskie">–°–≤–µ–Ω—Ç–æ–∫—à–∏—Å–∫–æ–µ (≈öwiƒôtokrzyskie)</option>
          <option value="Warmi≈Ñsko-Mazurskie">–í–∞—Ä–º–∏–Ω—å—Å–∫–æ-–ú–∞–∑—É—Ä—Å–∫–æ–µ (Warmi≈Ñsko-Mazurskie)</option>
          <option value="Wielkopolskie">–í–µ–ª–∏–∫–æ–ø–æ–ª—å—Å–∫–æ–µ (Wielkopolskie)</option>
          <option value="Zachodniopomorskie">–ó–∞–ø–∞–¥–Ω–æ-–ü–æ–º–æ—Ä—Å–∫–æ–µ (Zachodniopomorskie)</option>
        </select>
      </div>
      
      <div id="oplata_data" style="display:none">
        <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>
  </div>
</div>

<!-- ====== Umowa najmu / Meldunek ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="rent_modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closeRentModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: –∑–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="rent_step1">
      <h3>–ó–∞–≥—Ä—É–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
      <div class="small">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PDF, JPG, PNG (–¥–æ ~20 –ú–ë).</div>
      <div id="rent_checked_info" class="status ok" style="display:none;margin-top:10px"></div>
      <input id="rent_file" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" />
      <div class="hr"></div>
      <button id="rent_btn_upload" class="primary" disabled onclick="rentStart()">
        <span style="display:flex;align-items:center;justify-content:center;gap:8px">
          <span style="font-size:18px">ü§ñ</span>
          <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å AI</span>
        </span>
      </button>
      <div class="small muted" style="margin-top:12px;text-align:center">
        <a href="javascript:void(0)" onclick="rentNoDoc()" class="help-link">–£ –º–µ–Ω—è –Ω–µ—Ç ‚Äî –ø–æ–º–æ–≥–∏—Ç–µ</a>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 2: –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ -->
    <div id="rent_step2" style="display:none">
      <h3>AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω</h3>
      <div class="completion-info" style="margin:20px 0;text-align:center">
        <div style="font-size:48px;margin-bottom:16px">‚è∞</div>
        <div style="font-size:18px;font-weight:600;margin-bottom:8px">–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤</div>
        <div id="rent_completion_date" style="font-size:24px;color:var(--accent);font-weight:700;margin-bottom:8px"></div>
        <div id="rent_completion_time" style="font-size:16px;color:var(--muted)"></div>
      </div>
      <div class="status" id="rent_queue_msg" style="margin-top:16px">
        –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ <span id="rent_time_remaining">—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</span>
      </div>
      <div class="small muted" style="margin-top:12px">
        –ú–æ–∂–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å AI –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã—Å—Ç—Ä–µ–µ
      </div>
      <div style="margin-top:20px">
        <button id="rent_btn_boost" class="primary" onclick="rentBoost()" style="width:100%">–£—Å–∫–æ—Ä—è—é!</button>
      </div>
      <div class="small muted" id="rent_poll_note" style="margin-top:8px"></div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 3: –æ–ø–ª–∞—Ç–∞ -->
    <div id="rent_step3" style="display:none">
      <h3>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</h3>
      <div class="status" style="margin-top:16px">
        <div class="center">
          <div style="font-size:24px;color:var(--accent);margin-bottom:8px">‚ö°</div>
          <div>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 1 —á–∞—Å –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div class="payment-details">
        <div class="payment-item">
          <span>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</span>
          <span class="payment-price">50 PLN</span>
        </div>
        <div class="payment-item">
          <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</span>
          <span class="payment-price">+20 PLN</span>
        </div>
        <div class="hr"></div>
        <div class="payment-total">
          <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
          <span class="payment-price total">70 PLN</span>
        </div>
      </div>
      
      <div style="margin-top:20px">
        <button class="primary" onclick="rentProcessPayment()" style="width:100%;margin-bottom:12px">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        <button class="ghost" onclick="rentBackToTimer()" style="width:100%">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 4: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="rent_step4" style="display:none">
      <h3 id="rent_result_title">–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ</h3>
      <div id="rent_result_box" class="status ok" style="margin-top:10px">
        <div id="rent_result_text">–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>
      </div>
      <div style="margin-top:20px">
        <button class="primary" onclick="rentBackToHome()" style="width:100%;margin-bottom:12px">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        <button class="ghost" onclick="rentStartOver()" style="width:100%">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Ubezpieczenie ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="insurance_modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closeInsuranceModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: –∑–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="insurance_step1">
      <h3>–ó–∞–≥—Ä—É–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
      <div class="small">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PDF, JPG, PNG (–¥–æ ~20 –ú–ë).</div>
      <div id="insurance_checked_info" class="status ok" style="display:none;margin-top:10px"></div>
      <input id="insurance_file" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" />
      <div class="hr"></div>
      <button id="insurance_btn_upload" class="primary" disabled onclick="insuranceStart()">
        <span style="display:flex;align-items:center;justify-content:center;gap:8px">
          <span style="font-size:18px">ü§ñ</span>
          <span>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å AI</span>
        </span>
      </button>
      <div class="small muted" style="margin-top:12px;text-align:center">
        <a href="javascript:void(0)" onclick="insuranceNoDoc()" class="help-link">–£ –º–µ–Ω—è –Ω–µ—Ç ‚Äî –ø–æ–º–æ–≥–∏—Ç–µ</a>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 2: –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ -->
    <div id="insurance_step2" style="display:none">
      <h3>AI –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω</h3>
      <div class="completion-info" style="margin:20px 0;text-align:center">
        <div style="font-size:48px;margin-bottom:16px">‚è∞</div>
        <div style="font-size:18px;font-weight:600;margin-bottom:8px">–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤</div>
        <div id="insurance_completion_date" style="font-size:24px;color:var(--accent);font-weight:700;margin-bottom:8px"></div>
        <div id="insurance_completion_time" style="font-size:16px;color:var(--muted)"></div>
      </div>
      <div class="status" id="insurance_queue_msg" style="margin-top:16px">
        –¢–≤–æ–π –∞–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ <span id="insurance_time_remaining">—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</span>
      </div>
      <div class="small muted" style="margin-top:12px">
        –ú–æ–∂–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å AI –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã—Å—Ç—Ä–µ–µ
      </div>
      <div style="margin-top:20px">
        <button id="insurance_btn_boost" class="primary" onclick="insuranceBoost()" style="width:100%">–£—Å–∫–æ—Ä—è—é!</button>
      </div>
      <div class="small muted" id="insurance_poll_note" style="margin-top:8px"></div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 3: –æ–ø–ª–∞—Ç–∞ -->
    <div id="insurance_step3" style="display:none">
      <h3>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</h3>
      <div class="status" style="margin-top:16px">
        <div class="center">
          <div style="font-size:24px;color:var(--accent);margin-bottom:8px">‚ö°</div>
          <div>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ 1 —á–∞—Å –≤–º–µ—Å—Ç–æ 24 —á–∞—Å–æ–≤</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div class="payment-details">
        <div class="payment-item">
          <span>–£—Å–∫–æ—Ä–µ–Ω–∏–µ AI –∞–Ω–∞–ª–∏–∑–∞</span>
          <span class="payment-price">50 PLN</span>
        </div>
        <div class="payment-item">
          <span>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</span>
          <span class="payment-price">+20 PLN</span>
        </div>
        <div class="hr"></div>
        <div class="payment-total">
          <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
          <span class="payment-price total">70 PLN</span>
        </div>
      </div>
      
      <div style="margin-top:20px">
        <button class="primary" onclick="insuranceProcessPayment()" style="width:100%;margin-bottom:12px">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        <button class="ghost" onclick="insuranceBackToTimer()" style="width:100%">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 4: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="insurance_step4" style="display:none">
      <h3 id="insurance_result_title">–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ</h3>
      <div id="insurance_result_box" class="status ok" style="margin-top:10px">
        <div id="insurance_result_text">–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>
      </div>
      <div style="margin-top:20px">
        <button class="primary" onclick="insuranceBackToHome()" style="width:100%;margin-bottom:12px">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        <button class="ghost" onclick="insuranceStartOver()" style="width:100%">–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ‚Äî –º–æ–¥–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å -->
<div id="photos_modal" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <div class="row" style="align-items:center;margin-bottom:6px">
      <button class="ghost" style="flex:0 0 auto;width:auto" onclick="closePhotosModal()">‚Üê –ù–∞–∑–∞–¥</button>
      <span></span>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 1: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <div id="photos_step1">
      <h3>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º –¥–ª—è –í–ù–ñ</h3>
      <div class="status" style="margin-top:14px">
        <div class="center">
          <div style="font-size:20px;margin-bottom:6px">üì∏</div>
          <div style="font-size:14px">–¢—Ä–µ–±—É–µ—Ç—Å—è 4 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –ù–∞–π–¥–∏ —Ñ–æ—Ç–æ –∞—Ç–µ–ª—å–µ —Ä—è–¥–æ–º</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div class="photo-requirements">
        <div class="requirement-item">
          <span>–†–∞–∑–º–µ—Ä:</span>
          <span class="requirement-value">35 x 45 –º–º</span>
        </div>
        <div class="requirement-item">
          <span>–§–æ–Ω:</span>
          <span class="requirement-value">–ë–µ–ª—ã–π</span>
        </div>
        <div class="requirement-item">
          <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
          <span class="requirement-value">4 —à—Ç</span>
        </div>
        <div class="requirement-item">
          <span>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</span>
          <span class="requirement-value">–ù–µ —Å—Ç–∞—Ä—à–µ 6 –º–µ—Å</span>
        </div>
      </div>
      
      <div style="margin-top:20px">
        <button class="primary" onclick="findPhotoStudios()" style="width:100%">–ù–∞–π—Ç–∏ —Ñ–æ—Ç–æ –∞—Ç–µ–ª—å–µ —Ä—è–¥–æ–º</button>
      </div>
      
      <div class="center" style="margin-top:20px">
        <a href="javascript:void(0)" onclick="markPhotosDone()" style="text-decoration:underline;color:var(--accent)">
          –Ø —Å–¥–µ–ª–∞–ª
        </a>
      </div>
    </div>

    <!-- —ç–∫—Ä–∞–Ω 2: —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ç–æ–∞—Ç–µ–ª—å–µ -->
    <div id="photos_step2" style="display:none">
      <h3 style="margin-bottom:12px">–§–æ—Ç–æ–∞—Ç–µ–ª—å–µ —Ä—è–¥–æ–º —Å –≤–∞–º–∏</h3>
      
      <div class="photo-studios">
        <div class="studio-item">
          <div class="studio-info">
            <h4>Foto Studio Centrum</h4>
            <div class="studio-details">
              <span>üìç ul. Marsza≈Çkowska 15, Warszawa</span>
              <span>üìû +48 22 123 45 67</span>
              <span>‚è∞ –ü–Ω-–ü—Ç 9:00-18:00</span>
            </div>
          </div>
          <div class="studio-actions">
            <button class="primary" onclick="callStudio('+48 22 123 45 67')">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
            <button class="ghost" onclick="openMap('ul. Marsza≈Çkowska 15, Warszawa')">–ö–∞—Ä—Ç–∞</button>
          </div>
        </div>
        
        <div class="studio-item">
          <div class="studio-info">
            <h4>Foto Express</h4>
            <div class="studio-details">
              <span>üìç ul. Nowy ≈öwiat 28, Warszawa</span>
              <span>üìû +48 22 987 65 43</span>
              <span>‚è∞ –ü–Ω-–°–± 8:00-20:00</span>
            </div>
          </div>
          <div class="studio-actions">
            <button class="primary" onclick="callStudio('+48 22 987 65 43')">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
            <button class="ghost" onclick="openMap('ul. Nowy ≈öwiat 28, Warszawa')">–ö–∞—Ä—Ç–∞</button>
          </div>
        </div>
        
        <div class="studio-item">
          <div class="studio-info">
            <h4>Foto Pro</h4>
            <div class="studio-details">
              <span>üìç ul. Krakowskie Przedmie≈õcie 12, Warszawa</span>
              <span>üìû +48 22 555 44 33</span>
              <span>‚è∞ –ü–Ω-–í—Å 10:00-19:00</span>
            </div>
          </div>
          <div class="studio-actions">
            <button class="primary" onclick="callStudio('+48 22 555 44 33')">–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
            <button class="ghost" onclick="openMap('ul. Krakowskie Przedmie≈õcie 12, Warszawa')">–ö–∞—Ä—Ç–∞</button>
          </div>
        </div>
      </div>
      
      <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--line)">
        <button class="primary" onclick="markPhotosDone()" style="width:100%;margin-bottom:10px">–ì–æ—Ç–æ–≤–æ</button>
        <button class="ghost" onclick="backToPhotosStep1()" style="width:100%">–ù–∞–∑–∞–¥ –∫ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º</button>
      </div>
    </div>
    
    <!-- —ç–∫—Ä–∞–Ω 3: —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É–∂–µ —Å–¥–µ–ª–∞–Ω—ã -->
    <div id="photos_step3" style="display:none">
      <div class="status ok" style="margin-top:16px">
        <div class="center">
          <div style="font-size:48px;margin-bottom:16px">‚úÖ</div>
          <div style="font-size:18px;font-weight:600;margin-bottom:8px">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≥–æ—Ç–æ–≤—ã!</div>
          <div style="color:var(--muted)">–¢—ã —É–∂–µ –æ—Ç–º–µ—Ç–∏–ª —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</div>
        </div>
      </div>
      
      <div class="hr"></div>
      
      <div style="margin-top:20px">
        <button class="ghost" onclick="closePhotosModal()" style="width:100%;margin-bottom:12px">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="ghost" onclick="resetPhotosStatus()" style="width:100%;font-size:14px;color:var(--muted)">
          –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç—É—Å (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // ====== Telegram init
  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  try { tg && tg.ready(); tg && tg.expand(); } catch(e) {}

  // ====== Custom checkbox handling
  document.addEventListener('DOMContentLoaded', function() {
    // Handle custom checkbox clicks - improved version
    document.addEventListener('click', function(e) {
      const label = e.target.closest('.custom-checkbox');
      if (label) {
        const checkbox = label.querySelector('input[type="checkbox"]');
        if (checkbox) {
          // Toggle checkbox state
          checkbox.checked = !checkbox.checked;
          
          // Update visual state
          if (checkbox.checked) {
            label.classList.add('checked');
          } else {
            label.classList.remove('checked');
          }
          
          // Trigger change event for form validation
          checkbox.dispatchEvent(new Event('change', { bubbles: true }));
          

        }
      }
    });
    
    // Also handle direct checkbox changes
    document.addEventListener('change', function(e) {
      if (e.target.classList.contains('grounds')) {
        const checkbox = e.target;
        const label = checkbox.closest('.custom-checkbox');
        
        if (checkbox.checked) {
          label.classList.add('checked');
        } else {
          label.classList.remove('checked');
        }
      }
    });
  });

  // ====== –ü—Ä–æ—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  const st = {
    track: localStorage.getItem('track') || null,
    tasks: JSON.parse(localStorage.getItem('tasks')||'[]'),
    profile: JSON.parse(localStorage.getItem('profile')||'{}')
  };

  // ====== –ö–æ–Ω—Ñ–∏–≥ AI-–º–æ–¥—É–ª—è
  const BACKEND_BASE = ""; // ‚Üê –µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä/–±–æ—Ç API, —É–∫–∞–∂–∏—Ç–µ –±–∞–∑–æ–≤—ã–π URL
  const ENDPOINTS = BACKEND_BASE ? {
    upload: BACKEND_BASE + "/upload",
    analyze: BACKEND_BASE + "/analyze",
    status: BACKEND_BASE + "/status"
  } : null;

  const AI_PROMPT = `–ü—Ä–æ–≤–µ—Ä—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–∫–æ–Ω—Ç—Ä–∞–∫—Ç/–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞ –í–ù–ñ –≤ –ü–æ–ª—å—à–µ).
1) –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤: —Å—Ç–æ—Ä–æ–Ω—ã, NIP/PESEL (–µ—Å–ª–∏ –µ—Å—Ç—å), –∞–¥—Ä–µ—Å–∞, –¥–∞—Ç—ã, –ø–æ–¥–ø–∏—Å–∏, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.
2) –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è: –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –§–ò–û —Å –∞–Ω–∫–µ—Ç–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—É—Å—Ç—ã–µ –ø–æ–ª—è, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –¥–∞—Ç—ã.
3) –†–∏—Å–∫–∏ –¥–ª—è –í–ù–ñ: –ø—É–Ω–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –æ—Ç–∫–∞–∑ (–Ω–µ–ø–æ–ª–Ω–∞—è –∑–∞–Ω—è—Ç–æ—Å—Ç—å, –Ω–µ—Ç –∞–¥—Ä–µ—Å–∞, –Ω–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω–∏—è).
4) –ò—Ç–æ–≥: –∫–æ—Ä–æ—Ç–∫–∏–π –≤–µ—Ä–¥–∏–∫—Ç (OK / –µ—Å—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è) –∏ —á–µ–∫–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
–í—ã–≤–æ–¥–∏ —Å–ø–∏—Å–æ–∫ –ø—É–Ω–∫—Ç–æ–≤ —Å –∫—Ä–∞—Ç–∫–∏–º–∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏. –Ø–∑—ã–∫ –æ—Ç–≤–µ—Ç–∞ ‚Äî —Ä—É—Å—Å–∫–∏–π.`;

  // ====== –ë–∞–∑–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
  function baseTasks(track){
    const common = [
      {id:'wniosek', title:'Wniosek (PDF)', status:'todo', requiresAI:true, kind:'wniosek'},
      {id:'photos', title:'–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏', status:'todo', requiresAI:false, kind:'photos'},
      {id:'skarb', title:'Op≈Çata skarbowa', status:'todo', requiresAI:false, kind:'skarb'},
      {id:'rent', title:'Umowa najmu / Meldunek', status:'todo', requiresAI:true, kind:'rent'},
      {id:'ins', title:'Ubezpieczenie', status:'todo', requiresAI:true, kind:'insurance'},

    ];
    if(track==='work'||track==='business'){
      common.splice(2,0,{id:'contract', title:'–ö–æ–Ω—Ç—Ä–∞–∫—Ç / –û—Å–Ω–æ–≤–∞–Ω–∏–µ', status:'todo', requiresAI:true, kind:'contract'});
      common.splice(3,0,{id:'za≈ÇƒÖcznik', title:'Za≈ÇƒÖcznik od pracodawcy', status:'todo', requiresAI:true, kind:'za≈ÇƒÖcznik'});
    }
    if(track==='study'){
      common.splice(2,0,{id:'uni', title:'–°–ø—Ä–∞–≤–∫–∞ –∏–∑ –≤—É–∑–∞', status:'todo', requiresAI:true, kind:'university'});
      common.splice(3,0,{id:'funds', title:'–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö', status:'todo', requiresAI:true, kind:'funds'});
    }
    return common;
  }

  // ====== Voivodeship hint
  function officeHintByVoiv(v){
    const map = {
      'Mazowieckie': '–í–∞—à —É–∂–æ–Ω–¥: Mazowiecki UrzƒÖd Wojew√≥dzki w Warszawie, pl. Bankowy 3/5, 00-950 Warszawa',
      'Ma≈Çopolskie': '–í–∞—à —É–∂–æ–Ω–¥: Ma≈Çopolski UrzƒÖd Wojew√≥dzki w Krakowie, Wydzia≈Ç Spraw Cudzoziemc√≥w, ul. Przy Rondzie 6, 31-547 Krak√≥w',
      'Pomorskie': '–í–∞—à —É–∂–æ–Ω–¥: Pomorski UrzƒÖd Wojew√≥dzki w Gda≈Ñsku, ul. Okopowa 21/27, 80-810 Gda≈Ñsk (–í–∞–∂–Ω–æ: –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å)',
      'Dolno≈õlƒÖskie': '–í–∞—à —É–∂–æ–Ω–¥: Dolno≈õlƒÖski UrzƒÖd Wojew√≥dzki we Wroc≈Çawiu, pl. Powsta≈Ñc√≥w Warszawy 1, 50-153 Wroc≈Çaw',
      'Kujawsko-Pomorskie': '–í–∞—à —É–∂–æ–Ω–¥: Kujawsko-Pomorski UrzƒÖd Wojew√≥dzki w Bydgoszczy, ul. Jagiello≈Ñska 3, 85-950 Bydgoszcz',
      'Lubelskie': '–í–∞—à —É–∂–æ–Ω–¥: Lubelski UrzƒÖd Wojew√≥dzki w Lublinie, ul. Spokojna 4, 20-914 Lublin (—Å –ø–æ–º–µ—Ç–∫–æ–π ¬´Wydzia≈Ç Spraw Obywatelskich i Cudzoziemc√≥w¬ª)',
      'Lubuskie': '–í–∞—à —É–∂–æ–Ω–¥: Lubuski UrzƒÖd Wojew√≥dzki w Gorzowie Wielkopolskim, ul. Jagiello≈Ñczyka 8, 66-400 Gorz√≥w Wielkopolski',
      '≈Å√≥dzkie': '–í–∞—à —É–∂–æ–Ω–¥: ≈Å√≥dzki UrzƒÖd Wojew√≥dzki w ≈Åodzi, ul. Piotrkowska 104, 90-926 ≈Å√≥d≈∫',
      'Opolskie': '–í–∞—à —É–∂–æ–Ω–¥: Opolski UrzƒÖd Wojew√≥dzki w Opolu, Wydzia≈Ç Spraw Obywatelskich i Cudzoziemc√≥w, ul. Piastowska 14, 45-082 Opole',
      'Podkarpackie': '–í–∞—à —É–∂–æ–Ω–¥: Podkarpacki UrzƒÖd Wojew√≥dzki w Rzeszowie, ul. Grunwaldzka 15, 35-959 Rzesz√≥w',
      'Podlaskie': '–í–∞—à —É–∂–æ–Ω–¥: Podlaski UrzƒÖd Wojew√≥dzki w Bia≈Çymstoku, ul. Mickiewicza 3, 15-213 Bia≈Çystok',
      '≈ölƒÖskie': '–í–∞—à —É–∂–æ–Ω–¥: ≈ölƒÖski UrzƒÖd Wojew√≥dzki w Katowicach, Wydzia≈Ç Spraw Cudzoziemc√≥w, ul. Jagiello≈Ñska 25, 40-032 Katowice',
      '≈öwiƒôtokrzyskie': '–í–∞—à —É–∂–æ–Ω–¥: ≈öwiƒôtokrzyski UrzƒÖd Wojew√≥dzki w Kielcach, al. IX Wiek√≥w Kielc 3, 25-516 Kielce',
      'Warmi≈Ñsko-Mazurskie': '–í–∞—à —É–∂–æ–Ω–¥: Warmi≈Ñsko-Mazurski UrzƒÖd Wojew√≥dzki w Olsztynie, Al. Marsz. J. Pi≈Çsudskiego 7/9, 10-575 Olsztyn',
      'Wielkopolskie': '–í–∞—à —É–∂–æ–Ω–¥: Wielkopolski UrzƒÖd Wojew√≥dzki w Poznaniu, al. Niepodleg≈Ço≈õci 16/18, 61-713 Pozna≈Ñ',
      'Zachodniopomorskie': '–í–∞—à —É–∂–æ–Ω–¥: Zachodniopomorski UrzƒÖd Wojew√≥dzki w Szczecinie, ul. Wa≈Çy Chrobrego 4, 70-502 Szczecin',
      'Inne': '–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —É–∂–æ–Ω–¥–∞–º –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞: https://gov.example'
    };
    return map[v] || '';
  }

  // ====== Track detection
  function determineTrack(groundValues){
    const has = k => groundValues.includes(k);
    if (has('Study')) return 'study';
    if (has('Family')) return 'family';
    if (has('Dzialalnosc')) return 'business';
    if (has('UoP') || has('UoD') || has('UoZ')) return 'work';
    return 'work';
  }

  // ====== Checklist render
  function renderChecklist(){
    const title = st.profile?.trackLabel ? `eMigrant ¬∑ –ß–µ–∫–ª–∏—Å—Ç (${st.profile.trackLabel})` : 'eMigrant ¬∑ –ß–µ–∫–ª–∏—Å—Ç';
    document.getElementById('title').innerText = title;

    const tasksDiv = document.getElementById('tasks');
    tasksDiv.innerHTML = '';
    const done = st.tasks.filter(t=>t.status==='done').length;
    const total = st.tasks.length || 1;
    document.getElementById('doneCount').innerText = done;
    document.getElementById('totalCount').innerText = total;
    document.getElementById('progressBar').style.width = Math.round(done/total*100)+'%';
    document.getElementById('officeHint').innerText = st.profile?.voivodeship ? officeHintByVoiv(st.profile.voivodeship) : '';

    st.tasks.forEach((t, index)=>{
      const card = document.createElement('div');
      card.className='card';
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      card.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      const badgeClass = t.status==='done'?'ok':(t.status==='inreview'?'warn':'');
      card.innerHTML = `
        <div class="row" style="align-items:center">
          <div style="flex:3">
            <h3 style="margin:0 0 6px">${t.title}</h3>
            <span class="badge ${badgeClass}">${t.status==='todo'?'To do':t.status==='inreview'?'In review':'Done'}</span>
            ${(t.requiresAI && t.status!=='done')?'<span class="small" style="margin-left:8px">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è AI-–ø—Ä–æ–≤–µ—Ä–∫–∞</span>':''}
          </div>
          <div style="flex:2">
            <div class="row">
              <button class="primary" onclick="openModule('${t.kind}')">–û—Ç–∫—Ä—ã—Ç—å</button>
              ${t.status!=='done'?'<button onclick="markDone(\''+t.id+'\')">–°–¥–µ–ª–∞–Ω–æ</button>':''}
            </div>
          </div>
        </div>
      `;
      tasksDiv.appendChild(card);
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, index * 100);
    });
  }

  function markDone(id){
    st.tasks = st.tasks.map(t=> t.id===id ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    renderChecklist();
  }

  // ====== –ù–∞–≤–∏–≥–∞—Ü–∏—è
  function openChecklist(){
    const onb = document.getElementById('onb');
    const home = document.getElementById('home');
    
    onb.style.opacity = '0';
    onb.style.transform = 'translateY(-20px)';
    onb.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      onb.style.display = 'none';
      home.style.display = 'block';
      home.style.opacity = '0';
      home.style.transform = 'translateY(20px)';
      home.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        home.style.opacity = '1';
        home.style.transform = 'translateY(0)';
    renderChecklist();
      }, 10);
    }, 400);
  }

  function openModule(kind){
    if(kind==='aiTranslator'){
      alert('AI Translator: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–∏—Å—å–º–æ/–¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –ø–µ—Ä–µ–≤–æ–¥ –∏ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ. (–í MVP-–∑–∞–≥–ª—É—à–∫–µ –∑–∞–≥—Ä—É–∑–∫–∞ –æ–ø—É—â–µ–Ω–∞)');
      return;
    }
    if(kind==='slot'){
      const dates = prompt('–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã/–¥–Ω–∏, –∫–æ–≥–¥–∞ –≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü–Ω/–°—Ä/–ü—Ç –∏–ª–∏ 20-25 –∞–≤–≥—É—Å—Ç–∞). –ú—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–º, –Ω–æ —Å–ª–æ—Ç –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.');
      alert('–°–ø–∞—Å–∏–±–æ! –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞.\n–í–∞—à–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–Ω–∏: '+(dates||'–Ω–µ —É–∫–∞–∑–∞–Ω–æ')+'\n–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–∞ ‚Äî –≤—Ä—É—á–Ω—É—é.');
      return;
    }
    if(kind==='bookAssistant'){
      const text = prompt('–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ, –æ —á—ë–º –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å. –ó–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç-–∞–∫–∫–∞—É–Ω—Ç.');
      alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –û–ö, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.');
      if(tg && tg.openTelegramLink) tg.openTelegramLink('https://t.me/'+(tg.initDataUnsafe?.user?.username||''));
      return;
    }
    if(kind==='photos'){
      openPhotosModal();
      return;
    }
    if(kind==='insurance'){
      openInsuranceModal();
      return;
    }
    if(kind==='wniosek'){
      const path = confirm('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫–∞–Ω –≤–Ω–µ—Å–∫–∞? (OK ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∞–Ω; –û—Ç–º–µ–Ω–∞ ‚Äî –ø—Ä–æ–π—Ç–∏ –∞–Ω–∫–µ—Ç—É –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF)');
      if(path){
        alert('–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫–∞–Ω. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–¥–ø–∏—Å—å, –¥–∞—Ç—ã, —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –§–ò–û.');
      } else {
        alert('–û—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–Ω–∫–µ—Ç–∞ –≤–Ω–µ—Å–∫–∞ ‚Üí –∑–∞—Ç–µ–º –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF –∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å.');
      }
      return;
    }
    if(kind==='contract'){ openContractModal(); return; }
    if(kind==='za≈ÇƒÖcznik'){ openZa≈ÇƒÖcznikModal(); return; }
    if(kind==='attachmentHR'){
      alert('–°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω, –æ—Ç–¥–∞–π—Ç–µ HR. –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π/—Å –ø–µ—á–∞—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç (AI-–ø—Ä–æ–≤–µ—Ä–∫–∞).');
      return;
    }
    if(kind==='rent'){
      openRentModal();
      return;
    }
    if(kind==='university'){
      alert('–°–ø—Ä–∞–≤–∫–∞ –∏–∑ –≤—É–∑–∞: –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí AI-–ø—Ä–æ–≤–µ—Ä–∫–∞. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –≥–¥–µ –ø–æ–ª—É—á–∏—Ç—å.');
      return;
    }
    if(kind==='funds'){
      alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥—Å—Ç–≤–∞—Ö: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –±–∞–Ω–∫–æ–≤—Å–∫—É—é —Å–ø—Ä–∞–≤–∫—É. AI-–ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî —Å—É–º–º–∞/–¥–∞—Ç–∞/—Ä–µ–∫–≤–∏–∑–∏—Ç—ã.');
      return;
    }
    if(kind==='skarb'){
      openOplataModal();
      return;
    }
  }

  // ====== –û–Ω–±–æ—Ä–¥–∏–Ω–≥
  function showQ(n){
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏
    const currentQ = document.querySelector('#onb [id^="q"]:not([style*="display: none"])');
    const nextQ = document.getElementById('q'+n);
    
    if(currentQ && nextQ && currentQ !== nextQ){
      // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
      currentQ.style.opacity = '0';
      currentQ.style.transform = 'translateX(-20px)';
      currentQ.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
        for(let i=1;i<=8;i++){ 
          const q = document.getElementById('q'+i);
          q.style.display = (i===n)?'':'none';
          q.style.opacity = '1';
          q.style.transform = 'translateX(0)';
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
        nextQ.style.opacity = '0';
        nextQ.style.transform = 'translateX(20px)';
        nextQ.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        setTimeout(() => {
          nextQ.style.opacity = '1';
          nextQ.style.transform = 'translateX(0)';
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥–æ—Ö–æ–¥–µ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ 7
          if(n === 7) {
            setTimeout(() => checkIncomeWarning(), 50);
          }
        }, 10);
      }, 300);
    } else {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
    for(let i=1;i<=8;i++){ document.getElementById('q'+i).style.display = (i===n)?'':'none' }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –¥–æ—Ö–æ–¥–µ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ 7
    if(n === 7) {
      setTimeout(() => checkIncomeWarning(), 50);
    }
    }
    
    document.getElementById('step').innerText = String(n);
  }
  function prevQ(n){ showQ(n) }

  function isAnswered(step){
    switch(step){
      case 1:{
        const fn=document.getElementById('firstName'), ln=document.getElementById('lastName');
        if(!fn.value.trim()){fn.focus();alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –∏–º—è.');return false;}
        if(!ln.value.trim()){ln.focus();alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ —Ñ–∞–º–∏–ª–∏—é.');return false;}
        return true;
      }
      case 2:{ const s=document.getElementById('voivodeship'); if(!s.value){s.focus();alert('–í—ã–±–µ—Ä–∏ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ.'); return false;} return true; }
      case 3:{ const s=document.getElementById('citizenship'); if(!s.value){s.focus();alert('–í—ã–±–µ—Ä–∏ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ.'); return false;} return true; }
      case 4:{ const s=document.getElementById('stayLength'); if(!s.value){s.focus();alert('–£–∫–∞–∂–∏ —Å—Ä–æ–∫ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è.'); return false;} return true; }
      case 5:{ const s=document.getElementById('currentStatus'); if(!s.value){s.focus();alert('–í—ã–±–µ—Ä–∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å.'); return false;} return true; }
      case 6:{ const any=Array.from(document.querySelectorAll('.grounds')).some(el=>el.checked); if(!any){alert('–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ.'); return false;} return true; }
      case 7:{ const s=document.getElementById('income'); if(!s.value){s.focus();alert('–£–∫–∞–∂–∏ –¥–æ—Ö–æ–¥.'); return false;} return true; }
      case 8:{ const s=document.getElementById('goal'); if(!s.value){s.focus();alert('–í—ã–±–µ—Ä–∏ —Ü–µ–ª—å.'); return false;} return true; }
      default:return true;
    }
  }
  function nextQValidated(curr,next){ if(isAnswered(curr)){ showQ(next); } }

  function finishOnb(){
    for(let i=1;i<=8;i++){ if(!isAnswered(i)){ showQ(i); return; } }

    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const voivodeship = document.getElementById('voivodeship').value;
    const citizenship = document.getElementById('citizenship').value;
    const stayLength = document.getElementById('stayLength').value;
    const currentStatus = document.getElementById('currentStatus').value;
    const income = document.getElementById('income').value;
    const goal = document.getElementById('goal').value;
    const grounds = Array.from(document.querySelectorAll('.grounds')).filter(el=>el.checked).map(el=>el.value);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –¥–æ—Ö–æ–¥–æ–º –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º "–†–∞–±–æ—Ç–∞"
    const workGrounds = ['UoP', 'UoD', 'UoZ'];
    const hasWorkGround = workGrounds.some(ground => grounds.includes(ground));
    
    if(income === '<4666' && hasWorkGround){
      const proceed = confirm(
        '‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –° –¥–æ—Ö–æ–¥–æ–º –Ω–∏–∂–µ 4666 PLN —Ç—ã –Ω–µ —Å–º–æ–∂–µ—à—å –ø–æ–¥–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–±—ã—Ç—É –ø–æ —Ä–∞–±–æ—Ç–µ.\n\n' +
        '–¢—ã —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏?\n\n' +
        '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º:\n' +
        '‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥ –¥–æ 4666+ PLN\n' +
        '‚Ä¢ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–£—á—ë–±–∞, –°–µ–º—å—è)\n' +
        '‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π'
      );
      
      if(!proceed){
        showQ(7); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≤–æ–ø—Ä–æ—Å—É –æ –¥–æ—Ö–æ–¥–µ
        return;
      }
    }

    const track = determineTrack(grounds);
    const trackLabel = track==='work'?'–†–∞–±–æ—Ç–∞':track==='study'?'–£—á—ë–±–∞':track==='family'?'–°–µ–º—å—è':'–ë–∏–∑–Ω–µ—Å';

    st.profile = { firstName, lastName, voivodeship, citizenship, stayLength, currentStatus, grounds, income, goal, track, trackLabel };
    localStorage.setItem('profile', JSON.stringify(st.profile));

    st.track = track;
    st.tasks = baseTasks(track);
    localStorage.setItem('track', track);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));

    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
    const onb = document.getElementById('onb');
    const home = document.getElementById('home');
    
    onb.style.opacity = '0';
    onb.style.transform = 'translateY(-20px)';
    onb.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      onb.style.display='none';
      home.style.display='';
      home.style.opacity = '0';
      home.style.transform = 'translateY(20px)';
      home.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        home.style.opacity = '1';
        home.style.transform = 'translateY(0)';
    renderChecklist();
      }, 10);
    }, 400);
  }

  // ====== –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –∫–∞—Ä—Ç—ã –ø–æ–±—ã—Ç—É
  function checkIncomeWarning(){
    const income = document.getElementById('income').value;
    const warning = document.getElementById('income_warning');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ "–†–∞–±–æ—Ç–∞"
    const workGrounds = ['UoP', 'UoD', 'UoZ'];
    const selectedGrounds = Array.from(document.querySelectorAll('.grounds:checked')).map(el => el.value);
    const hasWorkGround = workGrounds.some(ground => selectedGrounds.includes(ground));
    
    if(income === '<4666' && hasWorkGround){
      warning.style.display = 'block';
    } else {
      warning.style.display = 'none';
    }
  }

  // ====== Reset (—Ç–µ—Å—Ç—ã)
  function resetOnb(){
    if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –∞–Ω–∫–µ—Ç—É –∏ –Ω–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞?")){
      localStorage.removeItem('track');
      localStorage.removeItem('tasks');
      localStorage.removeItem('profile');
      st.track = null; st.tasks=[]; st.profile={};
      const home = document.getElementById('home');
      const onb = document.getElementById('onb');
      
      home.style.opacity = '0';
      home.style.transform = 'translateY(20px)';
      home.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        home.style.display='none';
        onb.style.display='';
        onb.style.opacity = '0';
        onb.style.transform = 'translateY(-20px)';
        onb.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        setTimeout(() => {
          onb.style.opacity = '1';
          onb.style.transform = 'translateY(0)';
      showQ(1);
        }, 10);
      }, 400);
    }
  }

  // ====== –ö–æ–Ω—Ç—Ä–∞–∫—Ç ‚Äî –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –ª–æ–≥–∏–∫–∞
  let ct = { file: null, fileMeta: null, jobId: null, pollTimer: null, boosted:false };
  
  // ====== Za≈ÇƒÖcznik od pracodawcy ‚Äî –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –ª–æ–≥–∏–∫–∞
  let za≈ÇƒÖcznik = { file: null, fileMeta: null, jobId: null, pollTimer: null, boosted:false };

  function el(id){ return document.getElementById(id); }
  function openContractModal(){
    ct = { file:null, fileMeta:null, jobId:null, pollTimer:null, boosted:false };
    
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
    const task = (st.tasks||[]).find(t=>t.id==='contract');
    
    if(task && task.status==='inreview'){
      // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç –±—ã–ª –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      el('ct_step1').style.display='none';
      el('ct_step2').style.display='none';
      el('ct_step3').style.display='none';
      el('ct_step4').style.display='';
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
      showRedFlagsResult();
    } else if(task && task.status==='done'){
      // –ï—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω —É—Å–ø–µ—à–Ω–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      el('ct_step1').style.display='none';
      el('ct_step2').style.display='none';
      el('ct_step3').style.display='none';
      el('ct_step4').style.display='';
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—Ö–∞
      showSuccessResult();
    } else {
      // –û–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω
    el('ct_step1').style.display='';
    el('ct_step2').style.display='none';
    el('ct_step3').style.display='none';
      el('ct_step4') && (el('ct_step4').style.display='none');
      
      // –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–º–µ—Ç–∫—É –µ—Å–ª–∏ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ
      try{
      const info = el('ct_checked_info');
      if(task && task.status==='done'){
        const ts = localStorage.getItem('contractCheckedAt');
        const dateStr = ts ? new Date(Number(ts)).toLocaleString() : new Date().toLocaleString();
        info.style.display='block';
        info.innerText = `–î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω: ${dateStr}`;
      } else {
        if(info){ info.style.display='none'; info.innerText=''; }
      }
    }catch(e){}
    
      el('ct_btn_upload').disabled = true;
      el('ct_file').value = '';
    }
  }
  function closeModal(){
    const modal = el('modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      if(ct.pollTimer){ clearInterval(ct.pollTimer); ct.pollTimer=null; }
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }
  function ctBackToHome(){ 
    closeModal(); 
    // –í Telegram Mini App –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.remove('no-header');
    openChecklist(); 
  }

  function za≈ÇƒÖcznikBackToHome(){ 
    closeZa≈ÇƒÖcznikModal(); 
    // –í Telegram Mini App –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.remove('no-header');
    openChecklist(); 
  }
  
  function ctStartOver(){
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    const task = st.tasks.find(t => t.id === 'contract');
    if(task && task.status === 'inreview'){
      st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'todo'} : t);
      localStorage.setItem('tasks', JSON.stringify(st.tasks));
      // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
      try { renderChecklist(); } catch(e) {}
    }
    
    // –û—á–∏—â–∞–µ–º localStorage –æ—Ç –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    localStorage.removeItem('contractTimerEnd');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
    const steps = ['ct_step1', 'ct_step2', 'ct_step3', 'ct_step4'];
    steps.forEach(stepId => {
      const step = el(stepId);
      if(step){
        step.style.opacity = '1';
        step.style.transform = 'translateX(0)';
        step.style.transition = '';
      }
    });
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —ç–∫—Ä–∞–Ω—É
    el('ct_step4').style.display='none';
    el('ct_step3').style.display='none';
    el('ct_step2').style.display='none';
    el('ct_step1').style.display='block';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      ct = { file:null, fileMeta:null, jobId:null, pollTimer:null, boosted:false };
    el('ct_btn_upload').disabled = true;
    el('ct_file').value = '';
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
    const info = el('ct_checked_info');
    if(info){ info.style.display='none'; info.innerText=''; }
  }

  function za≈ÇƒÖcznikStartOver(){
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    const task = st.tasks.find(t => t.id === 'za≈ÇƒÖcznik');
    if(task && task.status === 'inreview'){
      st.tasks = st.tasks.map(t=> t.id==='za≈ÇƒÖcznik' ? {...t, status:'todo'} : t);
      localStorage.setItem('tasks', JSON.stringify(st.tasks));
      // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
      try { renderChecklist(); } catch(e) {}
    }
    
    // –û—á–∏—â–∞–µ–º localStorage –æ—Ç –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    localStorage.removeItem('za≈ÇƒÖcznikTimerEnd');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
    const steps = ['za≈ÇƒÖcznik_step1', 'za≈ÇƒÖcznik_step2', 'za≈ÇƒÖcznik_step3', 'za≈ÇƒÖcznik_step4', 'za≈ÇƒÖcznik_step5'];
    steps.forEach(stepId => {
      const step = el(stepId);
      if(step){
        step.style.opacity = '1';
        step.style.transform = 'translateX(0)';
        step.style.transform = 'translateX(0)';
        step.style.transition = '';
      }
    });
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —ç–∫—Ä–∞–Ω—É
    el('za≈ÇƒÖcznik_step5').style.display='none';
    el('za≈ÇƒÖcznik_step4').style.display='none';
    el('za≈ÇƒÖcznik_step3').style.display='none';
    el('za≈ÇƒÖcznik_step2').style.display='none';
    el('za≈ÇƒÖcznik_step1').style.display='block';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    za≈ÇƒÖcznik = { file:null, fileMeta:null, jobId:null, pollTimer:null, boosted:false };
    el('za≈ÇƒÖcznik_btn_upload').disabled = true;
    el('za≈ÇƒÖcznik_file').value = '';
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
    const info = el('za≈ÇƒÖcznik_checked_info');
    if(info){ info.style.display='none'; info.innerText=''; }
  }

  // ====== –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
  function openPhotosModal(){
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('photos_modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    const photosTask = st.tasks.find(t => t.id === 'photos');
    
    if (photosTask && photosTask.status === 'done') {
      // –ï—Å–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É–∂–µ —Å–¥–µ–ª–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
      el('photos_step1').style.display='none';
      el('photos_step2').style.display='none';
      showPhotosCompletedScreen();
    } else {
      // –ï—Å–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π —ç–∫—Ä–∞–Ω
      el('photos_step1').style.display='';
      el('photos_step2').style.display='none';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
      const step1 = el('photos_step1');
      step1.style.opacity = '1';
      step1.style.transform = 'translateX(0)';
    }
  }
  
  function closePhotosModal(){
    const modal = el('photos_modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
      el('photos_step1').style.display='none';
      el('photos_step2').style.display='none';
      el('photos_step3').style.display='none';
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }

  function openZa≈ÇƒÖcznikModal(){
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('za≈ÇƒÖcznik_modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    el('za≈ÇƒÖcznik_step1').style.display='none';
    el('za≈ÇƒÖcznik_step2').style.display='none';
    el('za≈ÇƒÖcznik_step3').style.display='none';
    el('za≈ÇƒÖcznik_step4').style.display='none';
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    const downloadStatus = document.getElementById('za≈ÇƒÖcznik_download_status');
    const statusText = document.getElementById('za≈ÇƒÖcznik_status_text');
    const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
    const downloadBtn = document.getElementById('za≈ÇƒÖcznik_btn_download');
    const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
    
    if (downloadStatus) downloadStatus.style.display = 'none';
    if (statusText) statusText.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª...';
    if (manualDownload) manualDownload.style.display = 'none';
    if (availabilityWarning) availabilityWarning.style.display = 'none';
    if (downloadBtn) {
      downloadBtn.disabled = false;
      downloadBtn.innerHTML = '<span style="display:flex;align-items:center;justify-content:center;gap:8px"><span style="font-size:18px">üì•</span><span>–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</span></span>';
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ za≈ÇƒÖcznik
    const task = st.tasks.find(t => t.id === 'za≈ÇƒÖcznik');
    if(task && task.status === 'inreview'){
      el('za≈ÇƒÖcznik_step4').style.display='block';
      if(task.result === 'redflags'){
        showZa≈ÇƒÖcznikRedFlagsResult();
      } else {
        showZa≈ÇƒÖcznikSuccessResult();
      }
    } else if(task && task.status === 'done'){
      el('za≈ÇƒÖcznik_step4').style.display='block';
      showZa≈ÇƒÖcznikSuccessResult();
    } else {
      el('za≈ÇƒÖcznik_step1').style.display='block';
    }
  }

  function closeZa≈ÇƒÖcznikModal(){
    const modal = el('za≈ÇƒÖcznik_modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
      el('za≈ÇƒÖcznik_step1').style.display='none';
      el('za≈ÇƒÖcznik_step2').style.display='none';
      el('za≈ÇƒÖcznik_step3').style.display='none';
      el('za≈ÇƒÖcznik_step4').style.display='none';
      el('za≈ÇƒÖcznik_step5').style.display='none';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const downloadStatus = document.getElementById('za≈ÇƒÖcznik_download_status');
      const statusText = document.getElementById('za≈ÇƒÖcznik_status_text');
      if (downloadStatus) downloadStatus.style.display = 'none';
      if (statusText) statusText.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª...';
      
      // –°–∫—Ä—ã–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
      if (manualDownload) manualDownload.style.display = 'none';
      
      // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
      if (availabilityWarning) availabilityWarning.style.display = 'none';
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const downloadBtn = document.getElementById('za≈ÇƒÖcznik_btn_download');
      if (downloadBtn) {
        downloadBtn.disabled = false;
        downloadBtn.innerHTML = '<span style="display:flex;align-items:center;justify-content:center;gap:8px"><span style="font-size:18px">üì•</span><span>–°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</span></span>';
      }
      
      // –û—á–∏—â–∞–µ–º —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
      if(za≈ÇƒÖcznik.pollTimer){ clearInterval(za≈ÇƒÖcznik.pollTimer); za≈ÇƒÖcznik.pollTimer=null; }
      
      // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ za≈ÇƒÖcznik
      za≈ÇƒÖcznik = { file:null, fileMeta:null, jobId:null, pollTimer:null, boosted:false };
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
      el('za≈ÇƒÖcznik_btn_upload').disabled = true;
      el('za≈ÇƒÖcznik_file').value = '';
      
      // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≤–µ—Ä–∫–µ
      const info = el('za≈ÇƒÖcznik_checked_info');
      if(info){ info.style.display='none'; info.innerText=''; }
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }
  
  function findPhotoStudios(){
    const step1 = el('photos_step1');
    const step2 = el('photos_step2');
    
    step1.style.opacity = '0';
    step1.style.transform = 'translateX(-20px)';
    step1.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step1.style.display='none';
      step2.style.display='';
      step2.style.opacity = '0';
      step2.style.transform = 'translateX(20px)';
      step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step2.style.opacity = '1';
        step2.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }
  
  function backToPhotosStep1(){
    const step2 = el('photos_step2');
    const step1 = el('photos_step1');
    
    step2.style.opacity = '0';
    step2.style.transform = 'translateX(20px)';
    step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step2.style.display='none';
      step1.style.display='';
      step1.style.opacity = '0';
      step1.style.transform = 'translateX(-20px)';
      step1.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step1.style.opacity = '1';
        step1.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }
  
  function markPhotosDone(){
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
    st.tasks = st.tasks.map(t=> t.id==='photos' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
    try { renderChecklist(); } catch(e) {}
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closePhotosModal();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alert('–û—Ç–ª–∏—á–Ω–æ! –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ. üéâ');
  }
  
  function showPhotosCompletedScreen(){
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    el('photos_step1').style.display='none';
    el('photos_step2').style.display='none';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    const step3 = el('photos_step3');
    step3.style.display='';
    step3.style.opacity = '0';
    step3.style.transform = 'translateY(20px)';
    step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step3.style.opacity = '1';
      step3.style.transform = 'translateY(0)';
    }, 10);
  }
  
  function resetPhotosStatus(){
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
    st.tasks = st.tasks.map(t=> t.id==='photos' ? {...t, status:'todo'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
    try { renderChecklist(); } catch(e) {}
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —ç–∫—Ä–∞–Ω
    el('photos_step3').style.display='none';
    el('photos_step2').style.display='none';
    
    const step1 = el('photos_step1');
    step1.style.display='';
    step1.style.opacity = '0';
    step1.style.transform = 'translateY(20px)';
    step1.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step1.style.opacity = '1';
      step1.style.transform = 'translateY(0)';
    }, 10);
  }
  
  function callStudio(phone){
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∑–≤–æ–Ω–æ–∫
    if(tg && tg.openTelegramLink){
      tg.openTelegramLink(`tel:${phone}`);
    } else {
      window.open(`tel:${phone}`, '_blank');
    }
  }
  
  function openMap(address){
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É —Å –∞–¥—Ä–µ—Å–æ–º
    const mapUrl = `https://maps.google.com/?q=${encodeURIComponent(address)}`;
    if(tg && tg.openTelegramLink){
      tg.openTelegramLink(mapUrl);
    } else {
      window.open(mapUrl, '_blank');
    }
  }

  // enable button when file chosen
  el('ct_file').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    ct.file = f || null;
    el('ct_btn_upload').disabled = !ct.file;
  });

  // enable button when file chosen for za≈ÇƒÖcznik
  el('za≈ÇƒÖcznik_file').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    za≈ÇƒÖcznik.file = f || null;
    el('za≈ÇƒÖcznik_btn_upload').disabled = !za≈ÇƒÖcznik.file;
  });

  // enable button when file chosen for rent
  el('rent_file').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    rent.file = f || null;
    el('rent_btn_upload').disabled = !rent.file;
  });

  // enable button when file chosen for insurance
  el('insurance_file').addEventListener('change', (e)=>{
    const f = e.target.files[0];
    insurance.file = f || null;
    el('insurance_btn_upload').disabled = !insurance.file;
  });

  function ctNoDoc(){
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeModal();
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –≤ Telegram —Å –≥–æ—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    if(tg && tg.openTelegramLink){
      // –§–æ—Ä–º–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏');
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @emigrate_support
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        window.open(chatUrl, '_blank');
      }
    } else {
      // –ï—Å–ª–∏ Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }



  async function ctStart(){
    if(!ct.file){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.'); return; }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
    const step1 = el('ct_step1');
    const step2 = el('ct_step2');
    
    step1.style.opacity = '0';
    step1.style.transform = 'translateX(-20px)';
    step1.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step1.style.display='none';
      step2.style.display='';
      step2.style.opacity = '0';
      step2.style.transform = 'translateX(20px)';
      step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step2.style.opacity = '1';
        step2.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
    
    el('ct_step3').style.display='none';
    el('ct_step4').style.display='none';
    el('ct_poll_note').innerText = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –µ—Å–ª–∏ –Ω–µ—Ç backend
    if(!ENDPOINTS){
      showCompletionDate();
    }

    try{
      // 1) –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
      let uploadRes = null;
      if(ENDPOINTS){
        const fd = new FormData();
        fd.append('file', ct.file);
        fd.append('source', 'emigrant_webapp');
        const resp = await fetch(ENDPOINTS.upload, { method:'POST', body: fd });
        if(!resp.ok) throw new Error('Upload failed');
        uploadRes = await resp.json(); // –æ–∂–∏–¥–∞–µ–º {file_id, file_url, name, size}
      } else {
        // fallback: —à–ª—ë–º –±–æ—Ç—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –ø—É—Å—Ç—å –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤ —á–∞—Ç–µ
        uploadRes = { file_id: null, file_url: null, name: ct.file.name, size: ct.file.size };
      }

      ct.fileMeta = uploadRes;

      // 2) –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
      let analyzeRes = null;
      if(ENDPOINTS){
        const body = { file_id: uploadRes.file_id, file_url: uploadRes.file_url, prompt: AI_PROMPT, priority: ct.boosted?'high':'normal' };
        const resp = await fetch(ENDPOINTS.analyze, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        if(!resp.ok) throw new Error('Analyze start failed');
        analyzeRes = await resp.json(); // –æ–∂–∏–¥–∞–µ–º {job_id}
        ct.jobId = analyzeRes.job_id;
        startPolling();
      } else {
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç web_app_data
        try{
          tg && tg.sendData && tg.sendData(JSON.stringify({
            type:'analyze_contract',
            prompt: AI_PROMPT,
            fileMeta: { name: ct.file.name, size: ct.file.size },
            note:'–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ backend ENDPOINTS ‚Äî –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ sendData'
          }));
          // –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º fakeFinishOk() —Å—Ä–∞–∑—É - –∂–¥–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ 24 —á–∞—Å–∞
        }catch(e){}
      }

    }catch(err){
      console.error(err);
      el('ct_queue_msg').innerText = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
      el('ct_btn_boost').disabled = true;
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
  function showCompletionDate(){
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 24 —á–∞—Å–∞
    const endTime = new Date().getTime() + (24 * 60 * 60 * 1000);
    const completionDate = new Date(endTime);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ localStorage
    localStorage.setItem('contractTimerEnd', endTime.toString());
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    const dateEl = el('ct_completion_date');
    const timeEl = el('ct_completion_time');
    
    if(dateEl && timeEl){
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
      const dateOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      const timeOptions = { 
        hour: '2-digit', 
        minute: '2-digit' 
      };
      
      dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
      timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
    el('ct_time_remaining').innerText = '—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞';
    
    console.log('–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', completionDate.toLocaleString());
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–∞—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è za≈ÇƒÖcznik
  function showZa≈ÇƒÖcznikCompletionDate(){
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è: —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è + 24 —á–∞—Å–∞
    const endTime = new Date().getTime() + (24 * 60 * 60 * 1000);
    const completionDate = new Date(endTime);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤ localStorage
    localStorage.setItem('za≈ÇƒÖcznikTimerEnd', endTime.toString());
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    const dateEl = el('za≈ÇƒÖcznik_completion_date');
    const timeEl = el('za≈ÇƒÖcznik_completion_time');
    
    if(dateEl && timeEl){
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
      const dateOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      const timeOptions = { 
        hour: '2-digit', 
        minute: '2-digit' 
      };
      
      dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
      timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
    el('za≈ÇƒÖcznik_time_remaining').innerText = '—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞';
    
    console.log('–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ za≈ÇƒÖcznik —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', completionDate.toLocaleString());
  }

  function za≈ÇƒÖcznikUpdateTemplate(){
    const voivodeship = document.getElementById('za≈ÇƒÖcznik_voivodeship').value;
    const templateInfo = document.getElementById('za≈ÇƒÖcznik_template_info');
    const voivName = document.getElementById('za≈ÇƒÖcznik_voiv_name');
    const templateFile = document.getElementById('za≈ÇƒÖcznik_template_file');
    const templateSize = document.getElementById('za≈ÇƒÖcznik_template_size');
    const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
    const manualLink = document.getElementById('za≈ÇƒÖcznik_manual_link');
    
    if(voivodeship){
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∞–±–ª–æ–Ω–µ
      templateInfo.style.display = 'block';
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
      voivName.textContent = voivodeship;
      
      // –°–æ–∑–¥–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ –∏–º–µ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤
      const voivodeshipToFile = {
        'Dolno≈õlƒÖskie': 'za≈ÇƒÖcznik_dolnoslaskie.pdf',
        'Kujawsko-Pomorskie': 'za≈ÇƒÖcznik_kujawskopomorskie.pdf',
        'Lubelskie': 'za≈ÇƒÖcznik_lubelskie.pdf',
        'Lubuskie': 'za≈ÇƒÖcznik_lubuskie.pdf',
        '≈Å√≥dzkie': 'za≈ÇƒÖcznik_lodzkie.pdf',
        'Ma≈Çopolskie': 'za≈ÇƒÖcznik_malopolskie.pdf',
        'Mazowieckie': 'za≈ÇƒÖcznik_mazowieckie.pdf',
        'Opolskie': 'za≈ÇƒÖcznik_opolskie.pdf',
        'Podkarpackie': 'za≈ÇƒÖcznik_podkarpackie.pdf',
        'Podlaskie': 'za≈ÇƒÖcznik_podlaskie.pdf',
        'Pomorskie': 'za≈ÇƒÖcznik_pomorskie.pdf',
        '≈ölƒÖskie': 'za≈ÇƒÖcznik_slaskie.pdf',
        '≈öwiƒôtokrzyskie': 'za≈ÇƒÖcznik_swietokrzyskie.pdf',
        'Warmi≈Ñsko-Mazurskie': 'za≈ÇƒÖcznik_warminskomazurskie.pdf',
        'Wielkopolskie': 'za≈ÇƒÖcznik_wielkopolskie.pdf',
        'Zachodniopomorskie': 'za≈ÇƒÖcznik_zachodniopomorskie.pdf'
      };
      
      // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
      const filename = voivodeshipToFile[voivodeship];
      
      if (filename) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ–∞–π–ª –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
        const availableFiles = [
          'za≈ÇƒÖcznik_dolnoslaskie.pdf',
          'za≈ÇƒÖcznik_lubelskie.pdf', 
          'za≈ÇƒÖcznik_malopolskie.pdf',
          'za≈ÇƒÖcznik_opolskie.pdf',
          'za≈ÇƒÖcznik_podkarpackie.pdf',
          'za≈ÇƒÖcznik_lodzkie.pdf',
          'za≈ÇƒÖcznik_swietokrzyskie.pdf',
          'za≈ÇƒÖcznik_wielkopolskie.pdf',
          'za≈ÇƒÖcznik_mazowieckie.pdf'
        ];
        
        if (availableFiles.includes(filename)) {
          // –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω
          templateFile.textContent = filename;
          
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
          const fileSizes = {
            'za≈ÇƒÖcznik_dolnoslaskie.pdf': '603 KB',
            'za≈ÇƒÖcznik_lubelskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_malopolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_opolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_podkarpackie.pdf': '3.8 MB',
            'za≈ÇƒÖcznik_lodzkie.pdf': '762 KB',
            'za≈ÇƒÖcznik_swietokrzyskie.pdf': '707 KB',
            'za≈ÇƒÖcznik_wielkopolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_mazowieckie.pdf': '2.6 MB'
          };
          
          templateSize.textContent = fileSizes[filename] || '~2.6 MB';
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
          manualDownload.style.display = 'block';
          manualLink.href = encodeURI(`templates/${filename}`);
          manualLink.download = filename;
          
          // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
          const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
          if (availabilityWarning) {
            availabilityWarning.style.display = 'none';
          }
          
        } else {
          // –§–∞–π–ª –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º fallback
          templateFile.textContent = '–®–∞–±–ª–æ–Ω –Ω–µ –≥–æ—Ç–æ–≤, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback';
          templateSize.textContent = '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ú–∞–∑–æ–≤–µ—Ü–∫–æ–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ';
          manualDownload.style.display = 'none';
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
          const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
          if (availabilityWarning) {
            availabilityWarning.style.display = 'block';
          }
        }
        
      } else {
        templateFile.textContent = '–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω';
        templateSize.textContent = 'N/A';
        manualDownload.style.display = 'none';
      }
      
    } else {
      templateInfo.style.display = 'none';
      manualDownload.style.display = 'none';
    }
  }
  
  function za≈ÇƒÖcznikDownloadTemplate(){
    const voivodeship = document.getElementById('za≈ÇƒÖcznik_voivodeship').value;
    if(!voivodeship) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ');
      return;
    }
    
    console.log('–í—ã–±—Ä–∞–Ω–Ω–æ–µ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–æ:', voivodeship);
    
    // –°–æ–∑–¥–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ –∏–º–µ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤
    const voivodeshipToFile = {
      'Dolno≈õlƒÖskie': 'za≈ÇƒÖcznik_dolnoslaskie.pdf',
      'Kujawsko-Pomorskie': 'za≈ÇƒÖcznik_kujawskopomorskie.pdf',
      'Lubelskie': 'za≈ÇƒÖcznik_lubelskie.pdf',
      'Lubuskie': 'za≈ÇƒÖcznik_lubuskie.pdf',
      '≈Å√≥dzkie': 'za≈ÇƒÖcznik_lodzkie.pdf',
      'Ma≈Çopolskie': 'za≈ÇƒÖcznik_malopolskie.pdf',
      'Mazowieckie': 'za≈ÇƒÖcznik_mazowieckie.pdf',
      'Opolskie': 'za≈ÇƒÖcznik_opolskie.pdf',
      'Podkarpackie': 'za≈ÇƒÖcznik_podkarpackie.pdf',
      'Podlaskie': 'za≈ÇƒÖcznik_podlaskie.pdf',
      'Pomorskie': 'za≈ÇƒÖcznik_pomorskie.pdf',
      '≈ölƒÖskie': 'za≈ÇƒÖcznik_slaskie.pdf',
      '≈öwiƒôtokrzyskie': 'za≈ÇƒÖcznik_swietokrzyskie.pdf',
      'Warmi≈Ñsko-Mazurskie': 'za≈ÇƒÖcznik_warminskomazurskie.pdf',
      'Wielkopolskie': 'za≈ÇƒÖcznik_wielkopolskie.pdf',
      'Zachodniopomorskie': 'za≈ÇƒÖcznik_zachodniopomorskie.pdf'
    };
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
    const filename = voivodeshipToFile[voivodeship];
    if (!filename) {
      alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–∞–π–ª –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞');
      return;
    }
    
    // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ –ø–∞–ø–∫–µ templates
    const filePath = `templates/${filename}`;
    console.log('–°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª:', filePath);
    
    // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    const availableFiles = [
      'za≈ÇƒÖcznik_dolnoslaskie.pdf',
      'za≈ÇƒÖcznik_lubelskie.pdf', 
      'za≈ÇƒÖcznik_malopolskie.pdf',
      'za≈ÇƒÖcznik_opolskie.pdf',
      'za≈ÇƒÖcznik_podkarpackie.pdf',
      'za≈ÇƒÖcznik_lodzkie.pdf',
      'za≈ÇƒÖcznik_swietokrzyskie.pdf',
      'za≈ÇƒÖcznik_wielkopolskie.pdf',
      'za≈ÇƒÖcznik_mazowieckie.pdf'
    ];
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ñ–∞–π–ª –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
    if (availableFiles.includes(filename)) {
      // –§–∞–π–ª –µ—Å—Ç—å - —Å–∫–∞—á–∏–≤–∞–µ–º –µ–≥–æ
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
      const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
      const manualLink = document.getElementById('za≈ÇƒÖcznik_manual_link');
      if (manualDownload && manualLink) {
        manualDownload.style.display = 'block';
        manualLink.href = encodeURI(filePath);
        manualLink.download = filename;
      }
      
      // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
      if (availabilityWarning) {
        availabilityWarning.style.display = 'none';
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ
      const templateInfo = document.getElementById('za≈ÇƒÖcznik_template_info');
      if (templateInfo) {
        const templateFile = document.getElementById('za≈ÇƒÖcznik_template_file');
        const templateSize = document.getElementById('za≈ÇƒÖcznik_template_size');
        if (templateFile) templateFile.textContent = filename;
        if (templateSize) {
          const fileSizes = {
            'za≈ÇƒÖcznik_dolnoslaskie.pdf': '603 KB',
            'za≈ÇƒÖcznik_lubelskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_malopolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_opolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_podkarpackie.pdf': '3.8 MB',
            'za≈ÇƒÖcznik_lodzkie.pdf': '762 KB',
            'za≈ÇƒÖcznik_swietokrzyskie.pdf': '707 KB',
            'za≈ÇƒÖcznik_wielkopolskie.pdf': '2.6 MB',
            'za≈ÇƒÖcznik_mazowieckie.pdf': '2.6 MB'
          };
          templateSize.textContent = fileSizes[filename] || '~2.6 MB';
        }
      }
      
      downloadFile(filePath, filename);
    } else {
      // –§–∞–π–ª–∞ –Ω–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∑–æ–≤–µ—Ü–∫–∏–π –∫–∞–∫ fallback
      const fallbackPath = 'templates/za≈ÇƒÖcznik_mazowieckie.pdf';
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è fallback —Ñ–∞–π–ª–∞
      const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
      const manualLink = document.getElementById('za≈ÇƒÖcznik_manual_link');
      if (manualDownload && manualLink) {
        manualDownload.style.display = 'block';
        manualLink.href = encodeURI(fallbackPath);
        manualLink.download = 'za≈ÇƒÖcznik_mazowieckie.pdf';
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      const availabilityWarning = document.getElementById('za≈ÇƒÖcznik_availability_warning');
      if (availabilityWarning) {
        availabilityWarning.style.display = 'block';
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ fallback —Ñ–∞–π–ª–∞
      const templateInfo = document.getElementById('za≈ÇƒÖcznik_template_info');
      if (templateInfo) {
        const templateFile = document.getElementById('za≈ÇƒÖcznik_template_file');
        const templateSize = document.getElementById('za≈ÇƒÖcznik_template_size');
        if (templateFile) templateFile.textContent = 'za≈ÇƒÖcznik_mazowieckie.pdf (fallback)';
        if (templateSize) templateSize.textContent = '2.6 MB';
      }
      
      downloadFile(fallbackPath, 'za≈ÇƒÖcznik_mazowieckie.pdf');
      alert('–®–∞–±–ª–æ–Ω –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∞–±–ª–æ–Ω –ú–∞–∑–æ–≤–µ—Ü–∫–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞.');
    }
    
    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
    setTimeout(() => {
      el('za≈ÇƒÖcznik_step1').style.display = 'none';
      el('za≈ÇƒÖcznik_step2').style.display = 'block';
    }, 1000);
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
  function downloadFile(filePath, filename) {
    try {
      console.log('–ü—ã—Ç–∞–µ–º—Å—è —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª:', filePath);
      
      // –ö–æ–¥–∏—Ä—É–µ–º –ø—É—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è URL
      const encodedPath = encodeURI(filePath);
      console.log('–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å:', encodedPath);
      
      // –ú–µ—Ç–æ–¥ 1: –ü—Ä—è–º–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É
      const link = document.createElement('a');
      link.href = encodedPath;
      link.download = filename;
      link.style.display = 'none';
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –≤ DOM –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      console.log('–ú–µ—Ç–æ–¥ 1: –°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
      
      // –ú–µ—Ç–æ–¥ 2: –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –∫–∞–∫ fallback
      setTimeout(() => {
        console.log('–ú–µ—Ç–æ–¥ 2: –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ');
        window.open(encodedPath, '_blank');
      }, 500);
      
      // –ú–µ—Ç–æ–¥ 3: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      setTimeout(() => {
        const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
        const manualLink = document.getElementById('za≈ÇƒÖcznik_manual_link');
        if (manualDownload && manualLink) {
          manualDownload.style.display = 'block';
          manualLink.href = encodedPath;
          manualLink.download = filename;
        }
      }, 1000);
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:', error);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const manualDownload = document.getElementById('za≈ÇƒÖcznik_manual_download');
      if (manualDownload) {
        manualDownload.style.display = 'block';
      }
    }
  }

  async function za≈ÇƒÖcznikStart(){
    if(!za≈ÇƒÖcznik.file){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.'); return; }
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
    const step2 = el('za≈ÇƒÖcznik_step2');
    const step3 = el('za≈ÇƒÖcznik_step3');
    
    step2.style.opacity = '0';
    step2.style.transform = 'translateX(-20px)';
    step2.style.transform = 'translateX(-20px)';
    step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step2.style.display='none';
      step3.style.display='';
      step3.style.opacity = '0';
      step3.style.transform = 'translateX(20px)';
      step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step3.style.opacity = '1';
        step3.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
    
    el('za≈ÇƒÖcznik_step4').style.display='none';
    el('za≈ÇƒÖcznik_step5').style.display='none';
    el('za≈ÇƒÖcznik_poll_note').innerText = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –µ—Å–ª–∏ –Ω–µ—Ç backend
    if(!ENDPOINTS){
      showZa≈ÇƒÖcznikCompletionDate();
    }

    try{
      // 1) –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
      let uploadRes = null;
      if(ENDPOINTS){
        const fd = new FormData();
        fd.append('file', za≈ÇƒÖcznik.file);
        fd.append('source', 'emigrant_webapp');
        const resp = await fetch(ENDPOINTS.upload, { method:'POST', body: fd });
        if(!resp.ok) throw new Error('Upload failed');
        uploadRes = await resp.json(); // –æ–∂–∏–¥–∞–µ–º {file_id, file_url, name, size}
    } else {
        // fallback: —à–ª—ë–º –±–æ—Ç—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –ø—É—Å—Ç—å –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –≤ —á–∞—Ç–µ
        uploadRes = { file_id: null, file_url: null, name: za≈ÇƒÖcznik.file.name, size: za≈ÇƒÖcznik.file.size };
      }

      za≈ÇƒÖcznik.fileMeta = uploadRes;

      // 2) –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
      let analyzeRes = null;
      if(ENDPOINTS){
        const body = { file_id: uploadRes.file_id, file_url: uploadRes.file_url, prompt: AI_PROMPT, priority: za≈ÇƒÖcznik.boosted?'high':'normal' };
        const resp = await fetch(ENDPOINTS.analyze, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
        if(!resp.ok) throw new Error('Analyze start failed');
        analyzeRes = await resp.json(); // –æ–∂–∏–¥–∞–µ–º {job_id}
        za≈ÇƒÖcznik.jobId = analyzeRes.job_id;
        startZa≈ÇƒÖcznikPolling();
    } else {
        // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç web_app_data
        try{
          tg && tg.sendData && tg.sendData(JSON.stringify({
            type:'analyze_za≈ÇƒÖcznik',
            prompt: AI_PROMPT,
            fileMeta: { name: za≈ÇƒÖcznik.file.name, size: za≈ÇƒÖcznik.file.size },
            note:'–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–≥–æ backend ENDPOINTS ‚Äî –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ sendData'
          }));
          // –ù–ï –∑–∞–ø—É—Å–∫–∞–µ–º fakeFinishOk() —Å—Ä–∞–∑—É - –∂–¥–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ 24 —á–∞—Å–∞
        }catch(e){}
      }

    }catch(err){
      console.error(err);
      el('za≈ÇƒÖcznik_queue_msg').innerText = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.';
      el('za≈ÇƒÖcznik_btn_boost').disabled = true;
    }
  }



  function ctBoost(){
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    const step2 = el('ct_step2');
    const step3 = el('ct_step3');
    
    step2.style.opacity = '0';
    step2.style.transform = 'translateX(-20px)';
    step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step2.style.display='none';
      step3.style.display='';
      step3.style.opacity = '0';
      step3.style.transform = 'translateX(20px)';
      step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step3.style.opacity = '1';
        step3.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }

  function za≈ÇƒÖcznikBoost(){
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    const step3 = el('za≈ÇƒÖcznik_step3');
    const step4 = el('za≈ÇƒÖcznik_step4');
    
    step3.style.opacity = '0';
    step3.style.transform = 'translateX(-20px)';
    step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step3.style.display='none';
      step4.style.display='';
      step4.style.opacity = '0';
      step4.style.transform = 'translateX(20px)';
      step4.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step4.style.opacity = '1';
        step4.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }
  
  // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Ç–∞–π–º–µ—Ä—É
  function ctBackToTimer(){
    const step3 = el('ct_step3');
    const step2 = el('ct_step2');
    
    step3.style.opacity = '0';
    step3.style.transform = 'translateX(20px)';
    step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step3.style.display='none';
      step2.style.display='';
      step2.style.opacity = '0';
      step2.style.transform = 'translateX(-20px)';
      step2.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step2.style.opacity = '1';
        step2.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }

  function za≈ÇƒÖcznikBackToTimer(){
    const step4 = el('za≈ÇƒÖcznik_step4');
    const step3 = el('za≈ÇƒÖcznik_step3');
    
    step4.style.opacity = '0';
    step4.style.transform = 'translateX(20px)';
    step4.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    
    setTimeout(() => {
      step4.style.display='none';
      step3.style.display='';
      step3.style.opacity = '0';
      step3.style.transform = 'translateX(-20px)';
      step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step3.style.opacity = '1';
        step3.style.transform = 'translateX(0)';
      }, 10);
    }, 300);
  }
  
  // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã
  function ctProcessPayment(){
    // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã
    el('ct_poll_note').innerText = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–ø–ª–∞—Ç—ã...';
    
    setTimeout(() => {
      // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    ct.boosted = true;
      

      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
      const step3 = el('ct_step3');
      const step4 = el('ct_step4');
      
      step3.style.opacity = '0';
      step3.style.transform = 'translateX(-20px)';
      step3.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step3.style.display='none';
        step4.style.display='';
        step4.style.opacity = '0';
        step4.style.transform = 'translateX(20px)';
        step4.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        setTimeout(() => {
          step4.style.opacity = '1';
          step4.style.transform = 'translateX(0)';
        }, 10);
      }, 300);
      
      // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      el('ct_result_title').innerText = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...';
      el('ct_result_box').innerHTML = '<div class="spinner"></div><div style="margin-top:10px">AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç...</div>';
      
      // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      setTimeout(() => {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ–¥—Ö–æ–¥–∏—Ç/–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)
        const isDocumentOk = Math.random() > 0.3; // 70% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç
        
        if(isDocumentOk){
          // –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞
          showZa≈ÇƒÖcznikSuccessResult();
        } else {
          // –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
          showZa≈ÇƒÖcznikRedFlagsResult();
        }
      }, 3000);
      
    }, 2000);
  }
  
  function za≈ÇƒÖcznikProcessPayment(){
    // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã
    el('za≈ÇƒÖcznik_poll_note').innerText = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–ø–ª–∞—Ç—É...';
    
    setTimeout(() => {
      // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      za≈ÇƒÖcznik.boosted = true;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
      const step4 = el('za≈ÇƒÖcznik_step4');
      const step5 = el('za≈ÇƒÖcznik_step5');
      
      step4.style.opacity = '0';
      step4.style.transform = 'translateX(-20px)';
      step4.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        step4.style.display='none';
        step5.style.display='';
        step5.style.opacity = '0';
        step5.style.transform = 'translateX(20px)';
        step5.style.transition = 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        
        setTimeout(() => {
          step5.style.opacity = '1';
          step5.style.transform = 'translateX(0)';
        }, 10);
      }, 300);
      
      // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      el('za≈ÇƒÖcznik_result_title').innerText = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç...';
      el('za≈ÇƒÖcznik_result_box').innerHTML = '<div class="spinner"></div><div style="margin-top:10px">AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç...</div>';
      
      // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      setTimeout(() => {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ–¥—Ö–æ–¥–∏—Ç/–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)
        const isDocumentOk = Math.random() > 0.3; // 70% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç
        
        if(isDocumentOk){
          // –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞
          showZa≈ÇƒÖcznikSuccessResult();
        } else {
          // –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
          showZa≈ÇƒÖcznikRedFlagsResult();
        }
      }, 3000);
      
    }, 2000);
  }
  
  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  function showSuccessResult(){
    el('ct_result_title').innerText = '–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ';
    el('ct_result_box').className = 'status ok';
    el('ct_result_box').innerHTML = '<div>–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>';
    
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
    st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    localStorage.setItem('contractCheckedAt', String(Date.now()));
    // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
    try { renderChecklist(); } catch(e) {}
  }
  
  function showZa≈ÇƒÖcznikSuccessResult(){
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    el('za≈ÇƒÖcznik_step3').style.display='none';
    el('za≈ÇƒÖcznik_step4').style.display='none';
    el('za≈ÇƒÖcznik_step5').style.display='block';
    
    el('za≈ÇƒÖcznik_result_title').innerText = '–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ';
    el('za≈ÇƒÖcznik_result_box').className = 'status ok';
    el('za≈ÇƒÖcznik_result_box').innerHTML = '<div>–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>';
    
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
    st.tasks = st.tasks.map(t=> t.id==='za≈ÇƒÖcznik' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    localStorage.setItem('za≈ÇƒÖcznikCheckedAt', String(Date.now()));
    // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç, –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
    try { renderChecklist(); } catch(e) {}
  }
  
  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
  function showRedFlagsResult(){
    el('ct_result_title').innerText = '–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ —Ç–≤–æ–µ–π —É–º–æ–≤–µ';
    el('ct_result_box').className = 'status err';
    el('ct_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">‚ö†Ô∏è</div>
        <div>–£–∑–Ω–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π –Ω–∞—à–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showDetailedReport()" style="width:100%;margin-bottom:8px">
          –£–∑–Ω–∞—Ç—å —á—Ç–æ –Ω–µ —Ç–∞–∫
        </button>
        <button class="ghost" onclick="ignoreRedFlags()" style="width:100%;margin-bottom:8px">
          –ü—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button class="ghost" onclick="ctStartOver()" style="width:100%">
          –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–≥–æ–π –¥–æ–∫—É–º–µ–Ω—Ç
        </button>
      </div>
    `;
    
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ —Ç—Ä–µ–±—É—é—â—É—é –≤–Ω–∏–º–∞–Ω–∏—è
    st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'inreview'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
    try { renderChecklist(); } catch(e) {}
  }
  
  function showZa≈ÇƒÖcznikRedFlagsResult(){
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    el('za≈ÇƒÖcznik_step3').style.display='none';
    el('za≈ÇƒÖcznik_step4').style.display='none';
    el('za≈ÇƒÖcznik_step5').style.display='block';
    
    el('za≈ÇƒÖcznik_result_title').innerText = '–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ —Ç–≤–æ–µ–º za≈ÇƒÖcznik';
    el('za≈ÇƒÖcznik_result_box').className = 'status err';
    el('za≈ÇƒÖcznik_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">‚ö†Ô∏è</div>
        <div>–£–∑–Ω–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π –Ω–∞—à–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showZa≈ÇƒÖcznikDetailedReport()" style="width:100%;margin-bottom:8px">
          –£–∑–Ω–∞—Ç—å —á—Ç–æ –Ω–µ —Ç–∞–∫
        </button>
        <button class="secondary" onclick="contactZa≈ÇƒÖcznikSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
      </div>
    `;
    
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ —Ç—Ä–µ–±—É—é—â—É—é –≤–Ω–∏–º–∞–Ω–∏—è
    st.tasks = st.tasks.map(t=> t.id==='za≈ÇƒÖcznik' ? {...t, status:'inreview'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
    try { renderChecklist(); } catch(e) {}
  }
  
  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –¥–ª—è za≈ÇƒÖcznik
  function showZa≈ÇƒÖcznikDetailedReport(){
    el('za≈ÇƒÖcznik_result_title').innerText = '–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ za≈ÇƒÖcznik';
    el('za≈ÇƒÖcznik_result_box').className = 'status err';
    el('za≈ÇƒÖcznik_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">üìã</div>
        <div>–ü—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–µ–º za≈ÇƒÖcznik:</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 1:</strong> –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 2:</strong> –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ —Ç–∏–ø –¥–æ–≥–æ–≤–æ—Ä–∞
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 3:</strong> –ù–µ —É–∫–∞–∑–∞–Ω —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞
        </div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="contactZa≈ÇƒÖcznikSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
        <button class="ghost" onclick="showZa≈ÇƒÖcznikRedFlagsResult()" style="width:100%">
          –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        </button>
      </div>
    `;
  }
  
  // –§—É–Ω–∫—Ü–∏—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–ª—è za≈ÇƒÖcznik
  function contactZa≈ÇƒÖcznikSupport(){
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeZa≈ÇƒÖcznikModal();
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –≤ Telegram —Å –≥–æ—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    if(tg && tg.openTelegramLink){
      // –§–æ—Ä–º–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º Za≈ÇƒÖcznik nr1.');
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @emigrate_support
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        window.open(chatUrl, '_blank');
      }
    } else {
      // –ï—Å–ª–∏ Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º Za≈ÇƒÖcznik nr1.\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }
  
  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
  function showDetailedReport(){
    el('ct_result_box').innerHTML = `
      <div style="margin-bottom:16px">
        <h4>–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:</h4>
        <div style="margin:8px 0;padding:8px;background:#0c0f14;border-radius:6px">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 1:</strong> –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ
        </div>
        <div style="margin:8px 0;padding:8px;background:#0c0f14;border-radius:6px">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 2:</strong> –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω—É—é –∑–∞–Ω—è—Ç–æ—Å—Ç—å
        </div>
        <div style="margin:8px 0;padding:8px;background:#0c0f14;border-radius:6px">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 3:</strong> –ù–µ —É–∫–∞–∑–∞–Ω —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å —Ä–∞–±–æ—á–µ–≥–æ –º–µ—Å—Ç–∞
        </div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showRedFlagsResult()" style="width:100%">
          –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        </button>
      </div>
    `;
  }
  
  // –§—É–Ω–∫—Ü–∏—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∫—Ä–∞—Å–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤
  function ignoreRedFlags(){
    el('ct_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">ü§∑</div>
        <div>–í—ã —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
        <div style="font-size:12px;color:var(--muted);margin-top:8px">
          –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è, –Ω–æ –º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
        </div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showRedFlagsResult()" style="width:100%">
          –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        </button>
      </div>
    `;
    
    // –ü–æ–º–µ—á–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é (–Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã)
    st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ–∫–ª–∏—Å—Ç
    try { renderChecklist(); } catch(e) {}
  }

  function startPolling(){
    if(!ct.jobId){ return; }
    if(ct.pollTimer){ clearInterval(ct.pollTimer); }
    ct.pollTimer = setInterval(async ()=>{
      try{
        const url = ENDPOINTS.status + '?id=' + encodeURIComponent(ct.jobId);
        const resp = await fetch(url);
        if(!resp.ok) throw new Error('status failed');
        const data = await resp.json(); // –æ–∂–∏–¥–∞–µ–º {status:'queued|running|succeeded|failed', result?:{ok:boolean, issues?:[] , message?:string}}
        if(data.status==='queued' || data.status==='running'){
          el('ct_poll_note').innerText = data.status==='running' ? 'AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç‚Ä¶' : '–í –æ—á–µ—Ä–µ–¥–∏‚Ä¶';
          return;
        }
        clearInterval(ct.pollTimer); ct.pollTimer=null;
        showResultScreen(data);
      }catch(e){
        console.error(e);
        clearInterval(ct.pollTimer); ct.pollTimer=null;
        showResultScreen({status:'failed', result:{ ok:false, message:'–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞.' }});
      }
    }, 2500);
  }

  function showResultScreen(data){
    el('ct_step2').style.display='none';
    el('ct_step4').style.display='';
    const ok = data.status==='succeeded' && data.result?.ok!==false;
    el('ct_result_title').innerText = ok ? '–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ' : '–ù–∞–π–¥–µ–Ω—ã –∑–∞–º–µ—á–∞–Ω–∏—è';
    el('ct_result_box').className = 'status ' + (ok?'ok':'err');

    if(ok){
      el('ct_result_text').innerText = data.result?.message || '–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.';
      // –º–æ–∂–Ω–æ –ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –∫–∞–∫ "inreview" –∏–ª–∏ "done"
      st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'done'} : t);
      localStorage.setItem('tasks', JSON.stringify(st.tasks));
      try { renderChecklist(); } catch(e) {}
    }else{
      const issues = data.result?.issues || [];
      const text = (data.result?.message || '–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –ø—É–Ω–∫—Ç—ã:') + '\n' +
        (issues.length? issues.map((x,i)=>`${i+1}) ${x}`).join('\n') : '');
      el('ct_result_text').innerText = text.trim();
      st.tasks = st.tasks.map(t=> t.id==='contract' ? {...t, status:'inreview'} : t);
      localStorage.setItem('tasks', JSON.stringify(st.tasks));
      try { renderChecklist(); } catch(e) {}
    }
  }

  // –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–µ–∑ backend
  function fakeFinishOk(){
    setTimeout(()=>{
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ–¥—Ö–æ–¥–∏—Ç/–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç)
      const isDocumentOk = Math.random() > 0.3; // 70% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç
      
      if(isDocumentOk){
        // –î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞
        showSuccessResult();
      } else {
        // –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
        showRedFlagsResult();
      }
    }, 2000);
  }

  // ====== –ú–æ–¥–∞–ª–∫–∞ ‚Äî –æ—Ç–∫—Ä—ã—Ç–∏–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–∫–∏
  function closeOnBackdrop(e){ if(e.target.id==='modal') closeModal(); }
  document.getElementById('modal').addEventListener('click', closeOnBackdrop);
  
  function closeZa≈ÇƒÖcznikOnBackdrop(e){ if(e.target.id==='za≈ÇƒÖcznik_modal') closeZa≈ÇƒÖcznikModal(); }
  document.getElementById('za≈ÇƒÖcznik_modal').addEventListener('click', closeZa≈ÇƒÖcznikOnBackdrop);
  
  function closeOplataOnBackdrop(e){ if(e.target.id==='oplata_modal') closeOplataModal(); }
  document.getElementById('oplata_modal').addEventListener('click', closeOplataOnBackdrop);
  
  function closeRentOnBackdrop(e){ if(e.target.id==='rent_modal') closeRentModal(); }
  document.getElementById('rent_modal').addEventListener('click', closeRentOnBackdrop);
  
  function closeInsuranceOnBackdrop(e){ if(e.target.id==='insurance_modal') closeInsuranceModal(); }
  document.getElementById('insurance_modal').addEventListener('click', closeInsuranceOnBackdrop);
  
  document.getElementById('ct_btn_upload').disabled = true; // init
  document.getElementById('za≈ÇƒÖcznik_btn_upload').disabled = true; // init
  document.getElementById('rent_btn_upload').disabled = true; // init
  document.getElementById('insurance_btn_upload').disabled = true; // init

  // ====== Op≈Çata skarbowa ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
  function openOplataModal(){
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('oplata_modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    el('oplata_step1').style.display='block';
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
    el('oplata_voivodeship').value = '';
    el('oplata_data').style.display = 'none';
  }

  function closeOplataModal(){
    const modal = el('oplata_modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }

  function oplataUpdateData(){
    const voivodeship = el('oplata_voivodeship').value;
    const dataContainer = el('oplata_data');
    
    if(!voivodeship) {
      dataContainer.style.display = 'none';
      return;
    }
    
    // –î–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–µ–≤–æ–¥—Å—Ç–≤–∞
    const oplataData = {
      'Dolno≈õlƒÖskie': {
        recipient: 'Gmina Wroc≈Çaw',
        account: '82 1020 5226 0000 6102 0417 7895',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Kujawsko-Pomorskie': {
        recipient: 'UrzƒÖd Miasta Bydgoszczy, Wydzia≈Ç Podatk√≥w i Op≈Çat Lokalnych',
        account: '52 1240 6960 3892 1000 0000 0000',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Lubelskie': {
        recipient: 'UrzƒÖd Miasta Lublin, Wydzia≈Ç Podatk√≥w',
        account: '95 1240 2092 9329 9200 0620 0000',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Lubuskie': {
        recipient: 'UrzƒÖd Miasta Gorz√≥w Wielkopolski',
        account: '44 1020 5402 0000 0302 0325 6575',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      '≈Å√≥dzkie': {
        recipient: 'UrzƒÖd Miasta ≈Åodzi',
        account: '50 1240 1037 1111 0011 0925 0073',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Ma≈Çopolskie': {
        recipient: 'UrzƒÖd Miasta Krakowa',
        account: '49 1020 2892 2276 3005 0000 0000',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Mazowieckie': {
        recipient: 'UrzƒÖd m.st. Warszawy (Centrum Obs≈Çugi Podatnika)',
        account: '21 1030 1508 0000 0005 5000 0070',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Opolskie': {
        recipient: 'UrzƒÖd Miasta Opola',
        account: '03 1160 2202 0000 0002 1515 3249',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Podkarpackie': {
        recipient: 'UrzƒÖd Miasta Rzeszowa',
        account: '17 1020 4391 2018 0062 0000 0423',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Podlaskie': {
        recipient: 'UrzƒÖd Miejski w Bia≈Çymstoku, Departament Finans√≥w Miasta',
        account: '26 1240 5211 1111 0010 3553 3132',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Pomorskie': {
        recipient: 'UrzƒÖd Miejski w Gda≈Ñsku',
        account: '31 1240 1268 1111 0010 3877 3935',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      '≈ölƒÖskie': {
        recipient: 'UrzƒÖd Miasta Katowice',
        account: '52 1020 2313 2672 0211 1111 1111',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      '≈öwiƒôtokrzyskie': {
        recipient: 'UrzƒÖd Miasta Kielce',
        account: '38 1050 0099 6450 9000 0000 0000',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Warmi≈Ñsko-Mazurskie': {
        recipient: 'UrzƒÖd Miasta Olsztyna, Wydzia≈Ç Podatk√≥w i Op≈Çat',
        account: '09 1030 1508 0000 0008 2310 0003',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Wielkopolskie': {
        recipient: 'UrzƒÖd Miasta Poznania, Wydzia≈Ç Finansowy (Oddzia≈Ç Dochod√≥w Bud≈ºetowych)',
        account: '94 1020 4027 0000 1602 1262 0763',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      },
      'Zachodniopomorskie': {
        recipient: 'UrzƒÖd Miasta Szczecin, Wydzia≈Ç Podatk√≥w i Op≈Çat Lokalnych',
        account: '20 1020 4795 0000 9302 0277 9429',
        title: 'Op≈Çata skarbowa za wydanie zezwolenia na pobyt czasowy ‚Äì imiƒô i nazwisko',
        amount: '440 z≈Ç'
      }
    };
    
    const data = oplataData[voivodeship];
    if(data) {
      dataContainer.innerHTML = `
        <div class="oplata-info" style="background: var(--bg); padding: 20px; border-radius: 12px; margin: 20px 0;">
          <h4 style="margin: 0 0 16px 0; color: var(--accent);">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</h4>
          
          <div class="oplata-field">
            <label>–ü–æ–ª—É—á–∞—Ç–µ–ª—å (Odbiorca):</label>
            <div class="copy-field">
              <span class="copy-text">${data.recipient}</span>
              <button class="copy-btn" onclick="copyToClipboard('${data.recipient}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
              </button>
            </div>
          </div>
          
          <div class="oplata-field">
            <label>–ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ (Nr rachunku):</label>
            <div class="copy-field">
              <span class="copy-text">${data.account}</span>
              <button class="copy-btn" onclick="copyToClipboard('${data.account}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä —Å—á—ë—Ç–∞">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
              </button>
            </div>
          </div>
          
          <div class="oplata-field">
            <label>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (Tytu≈Ç przelewu):</label>
            <div class="copy-field">
              <span class="copy-text">${data.title}</span>
              <button class="copy-btn" onclick="copyToClipboard('${data.title}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
              </button>
            </div>
          </div>
          
          <div class="oplata-field">
            <label>–°—É–º–º–∞:</label>
            <div class="copy-field">
              <span class="copy-text">${data.amount}</span>
              <button class="copy-btn" onclick="copyToClipboard('${data.amount}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—É–º–º—É">
                –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
              </button>
            </div>
          </div>
        </div>
        
        <div class="oplata-actions" style="text-align: center; margin-top: 20px;">
          <div class="small muted">
            üí° –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –≤–∞—à –±–∞–Ω–∫ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
          </div>
        </div>
      `;
      
      dataContainer.style.display = 'block';
    }
  }

  function copyToClipboard(text) {
    if (navigator.clipboard && window.isSecureContext) {
      navigator.clipboard.writeText(text).then(() => {
        showCopySuccess();
      });
    } else {
      // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        document.execCommand('copy');
        showCopySuccess();
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
      }
      document.body.removeChild(textArea);
    }
  }



  // ====== Umowa najmu / Meldunek ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
  const rent = { file: null, boosted: false, jobId: null, pollTimer: null, fileMeta: null };

  function openRentModal(){
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('rent_modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    el('rent_step1').style.display='block';
    el('rent_step2').style.display='none';
    el('rent_step3').style.display='none';
    el('rent_step4').style.display='none';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ rent
    const task = st.tasks.find(t => t.id === 'rent');
    if(task && task.status === 'inreview'){
      el('rent_step4').style.display='block';
      if(task.result === 'redflags'){
        showRentRedFlagsResult();
      } else {
        showRentSuccessResult();
      }
    } else if(task && task.status === 'done'){
      el('rent_step4').style.display='block';
      showRentSuccessResult();
    } else {
      el('rent_step1').style.display='block';
    }
  }

  function closeRentModal(){
    const modal = el('rent_modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }

  function rentNoDoc(){
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeRentModal();
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –≤ Telegram —Å –≥–æ—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    if(tg && tg.openTelegramLink){
      // –§–æ—Ä–º–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É –¥–æ–≥–æ–≤–æ—Ä–∞ –∞—Ä–µ–Ω–¥—ã –∏–ª–∏ –º–µ–ª—å–¥—É–Ω–∫–∞. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏');
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @emigrate_support
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        window.open(chatUrl, '_blank');
      }
    } else {
      // –ï—Å–ª–∏ Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É –¥–æ–≥–æ–≤–æ—Ä–∞ –∞—Ä–µ–Ω–¥—ã –∏–ª–∏ –º–µ–ª—å–¥—É–Ω–∫–∞. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }

  // ====== Ubezpieczenie ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
  const insurance = { file: null, boosted: false, jobId: null, pollTimer: null, fileMeta: null };

  function openInsuranceModal(){
    // –í Telegram Mini App header —É–∂–µ —Å–∫—Ä—ã—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å
    const wrap = document.querySelector('.wrap');
    if(wrap) wrap.classList.add('no-header');
    
    const modal = el('insurance_modal');
    modal.style.display='grid';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    el('insurance_step1').style.display='block';
    el('insurance_step2').style.display='none';
    el('insurance_step3').style.display='none';
    el('insurance_step4').style.display='none';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ insurance
    const task = st.tasks.find(t => t.id === 'ins');
    if(task && task.status === 'inreview'){
      el('insurance_step4').style.display='block';
      if(task.result === 'redflags'){
        showInsuranceRedFlagsResult();
      } else {
        showInsuranceSuccessResult();
      }
    } else if(task && task.status === 'done'){
      el('insurance_step4').style.display='block';
      showInsuranceSuccessResult();
    } else {
      el('insurance_step1').style.display='block';
    }
  }

  function closeInsuranceModal(){
    const modal = el('insurance_modal');
    modal.classList.remove('show');
    setTimeout(() => {
      modal.style.display='none';
      
      // –í Telegram Mini App –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—Ç—É–ø
      const wrap = document.querySelector('.wrap');
      if(wrap) wrap.classList.remove('no-header');
    }, 300);
  }

  function insuranceNoDoc(){
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    closeInsuranceModal();
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç –≤ Telegram —Å –≥–æ—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    if(tg && tg.openTelegramLink){
      // –§–æ—Ä–º–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏');
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º @emigrate_support
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        // Fallback: –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        window.open(chatUrl, '_blank');
      }
    } else {
      // –ï—Å–ª–∏ Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –Ω–µ—Ç—É —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏. –•–æ—Ç–µ–ª –±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }

  // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥—É–ª—è Rent
  async function rentStart(){
    if(!rent.file){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.'); return; }
    
    el('rent_step1').style.display='none';
    el('rent_step2').style.display='';
    el('rent_step3').style.display='none';
    el('rent_step4').style.display='none';
    
    if(!ENDPOINTS){
      showRentCompletionDate();
      setTimeout(() => {
        const isDocumentOk = Math.random() > 0.3;
        if(isDocumentOk){
          showRentSuccessResult();
        } else {
          showRentRedFlagsResult();
        }
      }, 3000);
    }
  }

  function rentBoost(){
    el('rent_step2').style.display='none';
    el('rent_step3').style.display='';
  }

  function rentProcessPayment(){
    setTimeout(() => {
      rent.boosted = true;
      el('rent_step3').style.display='none';
      el('rent_step4').style.display='';
      
      setTimeout(() => {
        const isDocumentOk = Math.random() > 0.3;
        if(isDocumentOk){
          showRentSuccessResult();
        } else {
          showRentRedFlagsResult();
        }
      }, 3000);
    }, 2000);
  }

  function rentBackToTimer(){
    el('rent_step3').style.display='none';
    el('rent_step2').style.display='';
  }

  function rentBackToHome(){
    closeRentModal();
  }

  function rentStartOver(){
    el('rent_step4').style.display='none';
    el('rent_step1').style.display='';
    rent.file = null;
    el('rent_file').value = '';
    el('rent_btn_upload').disabled = true;
  }

  function showRentSuccessResult(){
    el('rent_step1').style.display='none';
    el('rent_step2').style.display='none';
    el('rent_step3').style.display='none';
    el('rent_step4').style.display='block';
    
    el('rent_result_title').innerText = '–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ';
    el('rent_result_box').className = 'status ok';
    el('rent_result_box').innerHTML = '<div>–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>';
    
    st.tasks = st.tasks.map(t=> t.id==='rent' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    localStorage.setItem('rentCheckedAt', String(Date.now()));
    try { renderChecklist(); } catch(e) {}
  }

  function showRentRedFlagsResult(){
    el('rent_step1').style.display='none';
    el('rent_step2').style.display='none';
    el('rent_step3').style.display='none';
    el('rent_step4').style.display='block';
    
    el('rent_result_title').innerText = '–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ —Ç–≤–æ–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ';
    el('rent_result_box').className = 'status err';
    el('rent_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">‚ö†Ô∏è</div>
        <div>–£–∑–Ω–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π –Ω–∞—à–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showRentDetailedReport()" style="width:100%;margin-bottom:8px">
          –£–∑–Ω–∞—Ç—å —á—Ç–æ –Ω–µ —Ç–∞–∫
        </button>
        <button class="secondary" onclick="contactRentSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
      </div>
    `;
    
    st.tasks = st.tasks.map(t=> t.id==='rent' ? {...t, status:'inreview'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    try { renderChecklist(); } catch(e) {}
  }

  function showRentDetailedReport(){
    el('rent_result_title').innerText = '–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É';
    el('rent_result_box').className = 'status err';
    el('rent_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">üìã</div>
        <div>–ü—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ:</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 1:</strong> –ù–µ—Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –∞—Ä–µ–Ω–¥—ã
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 2:</strong> –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–¥–ø–∏—Å–∏ —Å—Ç–æ—Ä–æ–Ω
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 3:</strong> –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è
        </div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="contactRentSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
        <button class="ghost" onclick="showRentRedFlagsResult()" style="width:100%">
          –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        </button>
      </div>
    `;
  }

  function contactRentSupport(){
    closeRentModal();
    
    if(tg && tg.openTelegramLink){
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –¥–æ–≥–æ–≤–æ—Ä–æ–º –∞—Ä–µ–Ω–¥—ã/–º–µ–ª—å–¥—É–Ω–∫–æ–º.');
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        window.open(chatUrl, '_blank');
      }
    } else {
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –¥–æ–≥–æ–≤–æ—Ä–æ–º –∞—Ä–µ–Ω–¥—ã/–º–µ–ª—å–¥—É–Ω–∫–æ–º.\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }

  function showRentCompletionDate(){
    const now = new Date();
    const completionDate = new Date(now.getTime() + 24 * 60 * 60 * 1000);
    
    const dateEl = el('rent_completion_date');
    const timeEl = el('rent_completion_time');
    
    if(dateEl && timeEl){
      const dateOptions = { month: 'long', day: 'numeric' };
      const timeOptions = { hour: '2-digit', minute: '2-digit' };
      
      dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
      timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
    }
  }

  // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥—É–ª—è Insurance
  async function insuranceStart(){
    if(!insurance.file){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª.'); return; }
    
    el('insurance_step1').style.display='none';
    el('insurance_step2').style.display='';
    el('insurance_step3').style.display='none';
    el('insurance_step4').style.display='none';
    
    if(!ENDPOINTS){
      showInsuranceCompletionDate();
      setTimeout(() => {
        const isDocumentOk = Math.random() > 0.3;
        if(isDocumentOk){
          showInsuranceSuccessResult();
        } else {
          showInsuranceRedFlagsResult();
        }
      }, 3000);
    }
  }

  function insuranceBoost(){
    el('insurance_step2').style.display='none';
    el('insurance_step3').style.display='';
  }

  function insuranceProcessPayment(){
    setTimeout(() => {
      insurance.boosted = true;
      el('insurance_step3').style.display='none';
      el('insurance_step4').style.display='';
      
      setTimeout(() => {
        const isDocumentOk = Math.random() > 0.3;
        if(isDocumentOk){
          showInsuranceSuccessResult();
        } else {
          showInsuranceRedFlagsResult();
        }
      }, 3000);
    }, 2000);
  }

  function insuranceBackToTimer(){
    el('insurance_step3').style.display='none';
    el('insurance_step2').style.display='';
  }

  function insuranceBackToHome(){
    closeInsuranceModal();
  }

  function insuranceStartOver(){
    el('insurance_step4').style.display='none';
    el('insurance_step1').style.display='';
    insurance.file = null;
    el('insurance_file').value = '';
    el('insurance_btn_upload').disabled = true;
  }

  function showInsuranceSuccessResult(){
    el('insurance_step1').style.display='none';
    el('insurance_step2').style.display='none';
    el('insurance_step3').style.display='none';
    el('insurance_step4').style.display='block';
    
    el('insurance_result_title').innerText = '–£—Ä–∞! –í—Å—ë —É–¥–∞–ª–æ—Å—å üéâ';
    el('insurance_result_box').className = 'status ok';
    el('insurance_result_box').innerHTML = '<div>–í—Å–µ —á—ë—Ç–∫–æ. –ó–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç.</div>';
    
    st.tasks = st.tasks.map(t=> t.id==='ins' ? {...t, status:'done'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    localStorage.setItem('insuranceCheckedAt', String(Date.now()));
    try { renderChecklist(); } catch(e) {}
  }

  function showInsuranceRedFlagsResult(){
    el('insurance_step1').style.display='none';
    el('insurance_step2').style.display='none';
    el('insurance_step3').style.display='none';
    el('insurance_step4').style.display='block';
    
    el('insurance_result_title').innerText = '–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –≤ —Ç–≤–æ–µ–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–µ';
    el('insurance_result_box').className = 'status err';
    el('insurance_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">‚ö†Ô∏è</div>
        <div>–£–∑–Ω–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π –Ω–∞—à–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="showInsuranceDetailedReport()" style="width:100%;margin-bottom:8px">
          –£–∑–Ω–∞—Ç—å —á—Ç–æ –Ω–µ —Ç–∞–∫
        </button>
        <button class="secondary" onclick="contactInsuranceSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
      </div>
    `;
    
    st.tasks = st.tasks.map(t=> t.id==='ins' ? {...t, status:'inreview'} : t);
    localStorage.setItem('tasks', JSON.stringify(st.tasks));
    try { renderChecklist(); } catch(e) {}
  }

  function showInsuranceDetailedReport(){
    el('insurance_result_title').innerText = '–î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–µ';
    el('insurance_result_box').className = 'status err';
    el('insurance_result_box').innerHTML = `
      <div style="text-align:center;margin-bottom:16px">
        <div style="font-size:24px;margin-bottom:8px">üìã</div>
        <div>–ü—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–µ–π —Å—Ç—Ä–∞—Ö–æ–≤–∫–µ:</div>
      </div>
      <div style="margin-bottom:16px">
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 1:</strong> –ò—Å—Ç–µ–∫–∞–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª–∏—Å–∞
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 2:</strong> –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—É–º–º–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
        </div>
        <div style="margin:8px 0;padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warn)">
          <strong>–ü—Ä–æ–±–ª–µ–º–∞ 3:</strong> –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±—É–µ–º—ã–µ –ø–æ–¥–ø–∏—Å–∏
        </div>
      </div>
      <div style="text-align:center">
        <button class="primary" onclick="contactInsuranceSupport()" style="width:100%;margin-bottom:8px">
          –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </button>
        <button class="ghost" onclick="showInsuranceRedFlagsResult()" style="width:100%">
          –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        </button>
      </div>
    `;
  }

  function contactInsuranceSupport(){
    closeInsuranceModal();
    
    if(tg && tg.openTelegramLink){
      const message = encodeURIComponent('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π.');
      const chatUrl = `https://t.me/emigrate_support?text=${message}`;
      
      try {
        tg.openTelegramLink(chatUrl);
      } catch(e) {
        window.open(chatUrl, '_blank');
      }
    } else {
      alert('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –º–Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å–æ —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π.\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Telegram: @emigrate_support');
    }
  }

  function showInsuranceCompletionDate(){
    const now = new Date();
    const completionDate = new Date(now.getTime() + 24 * 60 * 60 * 1000);
    
    const dateEl = el('insurance_completion_date');
    const timeEl = el('insurance_completion_time');
    
    if(dateEl && timeEl){
      const dateOptions = { month: 'long', day: 'numeric' };
      const timeOptions = { hour: '2-digit', minute: '2-digit' };
      
      dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
      timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
    }
  }

  function showCopySuccess() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease-out;
    `;
    notification.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
    
    // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(notification);
    
    // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease-in';
      notification.style.transform = 'translateX(100%)';
      notification.style.opacity = '0';
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 2000);
  }

  // ====== –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
  (function init(){
    if(st.track){
      document.getElementById('onb').style.display='none';
      document.getElementById('home').style.display='';
      renderChecklist();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
      const contractTimerEnd = localStorage.getItem('contractTimerEnd');
      if(contractTimerEnd){
        const endTime = parseInt(contractTimerEnd);
        const now = new Date().getTime();
        if(endTime > now){
          // –î–∞—Ç–∞ –µ—â–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
          const completionDate = new Date(endTime);
          const dateEl = el('ct_completion_date');
          const timeEl = el('ct_completion_time');
          
          if(dateEl && timeEl){
            const dateOptions = { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            };
            const timeOptions = { 
              hour: '2-digit', 
              minute: '2-digit' 
            };
            
            dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
            timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
          }
        } else {
          // –î–∞—Ç–∞ –∏—Å—Ç–µ–∫–ª–∞ - –æ—á–∏—â–∞–µ–º
          localStorage.removeItem('contractTimerEnd');
        }
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è –¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –¥–ª—è za≈ÇƒÖcznik
      const za≈ÇƒÖcznikTimerEnd = localStorage.getItem('za≈ÇƒÖcznikTimerEnd');
      if(za≈ÇƒÖcznikTimerEnd){
        const endTime = parseInt(za≈ÇƒÖcznikTimerEnd);
        const now = new Date().getTime();
        if(endTime > now){
          // –î–∞—Ç–∞ –µ—â–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
          const completionDate = new Date(endTime);
          const dateEl = el('za≈ÇƒÖcznik_completion_date');
          const timeEl = el('za≈ÇƒÖcznik_completion_time');
          
          if(dateEl && timeEl){
            const dateOptions = { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            };
            const timeOptions = { 
              hour: '2-digit', 
              minute: '2-digit' 
            };
            
            dateEl.innerText = completionDate.toLocaleDateString('ru-RU', dateOptions);
            timeEl.innerText = completionDate.toLocaleTimeString('ru-RU', timeOptions);
          }
        } else {
          // –î–∞—Ç–∞ –∏—Å—Ç–µ–∫–ª–∞ - –æ—á–∏—â–∞–µ–º
          localStorage.removeItem('za≈ÇƒÖcznikTimerEnd');
        }
      }
    } else {
      showQ(1);
    }
  })();
</script>
</body>
</html>
